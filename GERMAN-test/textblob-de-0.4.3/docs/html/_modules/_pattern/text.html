

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>_pattern.text &mdash; textblob-de 0.4.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> textblob-de
          

          
          </a>

          
            
            
              <div class="version">
                0.4.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">textblob-de README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Tutorial: Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced_usage.html">Advanced Usage: Overriding Models and the Blobber Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../make_info.html"><code class="docutils literal notranslate"><span class="pre">make</span></code> command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_makefile.html">Project <code class="docutils literal notranslate"><span class="pre">Makefile</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs_makefile.html">Documentation <code class="docutils literal notranslate"><span class="pre">Makefile</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">textblob-de</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>_pattern.text</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for _pattern.text</h1><div class="highlight"><pre>
<span></span><span class="c1">#### PATTERN | TEXT | PARSER #######################################################################</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Copyright (c) 2010 University of Antwerp, Belgium</span>
<span class="c1"># Author: Tom De Smedt &lt;tom@organisms.be&gt;</span>
<span class="c1"># License: BSD (see LICENSE.txt for details).</span>
<span class="c1"># http://www.clips.ua.ac.be/pages/pattern</span>

<span class="c1"># Source: https://github.com/clips/pattern/pattern/text/__init__.py</span>
<span class="c1"># git-commit: 2014-05-10 (2f944cb)</span>

<span class="c1"># Modified: 2015-05-02 Markus Killer &lt;m.killer@langui.ch&gt;</span>

<span class="c1">####################################################################################################</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">codecs</span>

<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="k">import</span> <span class="n">cElementTree</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">log</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">MODULE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">MODULE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">_pattern.compat</span> <span class="k">import</span> <span class="n">text_type</span><span class="p">,</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">basestring</span><span class="p">,</span> <span class="n">imap</span><span class="p">,</span> <span class="n">unicode</span><span class="p">,</span> <span class="n">binary_type</span><span class="p">,</span> <span class="n">PY2</span>

<span class="kn">from</span> <span class="nn">_pattern.text.tree</span> <span class="k">import</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Sentence</span><span class="p">,</span> <span class="n">Slice</span><span class="p">,</span> <span class="n">Chunk</span><span class="p">,</span> <span class="n">PNPChunk</span><span class="p">,</span> <span class="n">Chink</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">table</span>
<span class="kn">from</span> <span class="nn">_pattern.text.tree</span> <span class="k">import</span> <span class="n">SLASH</span><span class="p">,</span> <span class="n">WORD</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">CHUNK</span><span class="p">,</span> <span class="n">PNP</span><span class="p">,</span> <span class="n">REL</span><span class="p">,</span> <span class="n">ANCHOR</span><span class="p">,</span> <span class="n">LEMMA</span><span class="p">,</span> <span class="n">AND</span><span class="p">,</span> <span class="n">OR</span>

<span class="c1">#--- STRING FUNCTIONS ------------------------------------------------------------------------------</span>
<span class="c1"># Latin-1 (ISO-8859-1) encoding is identical to Windows-1252 except for the code points 128-159:</span>
<span class="c1"># Latin-1 assigns control codes in this range, Windows-1252 has characters, punctuation, symbols</span>
<span class="c1"># assigned to these code points.</span>

<span class="c1"># String functions</span>
<span class="k">def</span> <span class="nf">decode_string</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the given value as a Unicode string (if possible).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="p">((</span><span class="n">encoding</span><span class="p">,),)</span> <span class="o">+</span> <span class="p">((</span><span class="s2">&quot;windows-1252&quot;</span><span class="p">,),</span> <span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">binary_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">encode_string</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the given value as a Python byte string (if possible).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="p">((</span><span class="n">encoding</span><span class="p">,),)</span> <span class="o">+</span> <span class="p">((</span><span class="s2">&quot;windows-1252&quot;</span><span class="p">,),</span> <span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="n">decode_utf8</span> <span class="o">=</span> <span class="n">decode_string</span>
<span class="n">encode_utf8</span> <span class="o">=</span> <span class="n">encode_string</span>

<span class="n">decode_utf8</span> <span class="o">=</span> <span class="n">decode_string</span>
<span class="n">encode_utf8</span> <span class="o">=</span> <span class="n">encode_string</span>

<span class="n">PUNCTUATION</span> <span class="o">=</span> <span class="s2">&quot;.,;:!?()[]</span><span class="si">{}</span><span class="s2">`&#39;</span><span class="se">\&quot;</span><span class="s2">@#$^&amp;*+-|=~_&quot;</span>

<span class="k">def</span> <span class="nf">ngrams</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">punctuation</span><span class="o">=</span><span class="n">PUNCTUATION</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a list of n-grams (tuples of n successive words) from the given string.</span>
<span class="sd">        Alternatively, you can supply a Text or Sentence object.</span>
<span class="sd">        With continuous=False, n-grams will not run over sentence markers (i.e., .!?).</span>
<span class="sd">        Punctuation marks are stripped from words.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">strip_punctuation</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">punctuation</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">Word</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">string</span> <span class="ow">or</span> <span class="n">w</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">punctuation</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_punctuation</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">string</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Sentence</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_punctuation</span><span class="p">(</span><span class="n">string</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Text</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_punctuation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">string</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">continuous</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="c1">#s = [None] + s + [None]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">g</span>

<span class="k">def</span> <span class="nf">deflood</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the string with no more than n repeated characters, e.g.,</span>
<span class="sd">        deflood(&quot;NIIIICE!!&quot;, n=1) =&gt; &quot;Nice!&quot;</span>
<span class="sd">        deflood(&quot;nice.....&quot;, n=3) =&gt; &quot;nice...&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;((.)\2{</span><span class="si">%s</span><span class="s2">,})&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="p">[</span><span class="n">WORD</span><span class="p">,</span> <span class="n">POS</span><span class="p">,</span> <span class="n">CHUNK</span><span class="p">,</span> <span class="n">PNP</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Pretty-prints the output of Parser.parse() as a table with outlined columns.</span>
<span class="sd">        Alternatively, you can supply a tree.Text or tree.Sentence object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">table</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">Text</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">token</span><span class="p">)]))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Text</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">table</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">string</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Sentence</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">column</span><span class="p">))</span>

<span class="c1">#--- LAZY DICTIONARY -------------------------------------------------------------------------------</span>
<span class="c1"># A lazy dictionary is empty until one of its methods is called.</span>
<span class="c1"># This way many instances (e.g., lexicons) can be created without using memory until used.</span>

<span class="k">class</span> <span class="nc">lazydict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Must be overridden in a subclass.</span>
        <span class="c1"># Must load data with dict.__setitem__(self, k, v) instead of lazydict[k] = v.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the dictionary is empty, calls lazydict.load().</span>
<span class="sd">            Replaces lazydict.method() with dict.method() and calls it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">method</span><span class="p">),</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__repr__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__len__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__iter__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__contains__&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__setitem__&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;setdefault&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;popitem&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">lazylist</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Must be overridden in a subclass.</span>
        <span class="c1"># Must load data with list.append(self, v) instead of lazylist.append(v).</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the list is empty, calls lazylist.load().</span>
<span class="sd">            Replaces lazylist.method() with list.method() and calls it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">method</span><span class="p">),</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__repr__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__len__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__iter__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;__contains__&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy</span><span class="p">(</span><span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="c1">#### PARSER ########################################################################################</span>
<span class="c1"># Pattern&#39;s text parsers are based on Brill&#39;s algorithm, or optionally on a trained language model.</span>
<span class="c1"># Brill&#39;s algorithm automatically acquires a lexicon of known words (aka tag dictionary),</span>
<span class="c1"># and a set of rules for tagging unknown words from a training corpus.</span>
<span class="c1"># Morphological rules are used to tag unknown words based on word suffixes (e.g., -ly = adverb).</span>
<span class="c1"># Contextual rules are used to tag unknown words based on a word&#39;s role in the sentence.</span>
<span class="c1"># Named entity rules are used to annotate proper nouns (NNP&#39;s: Google = NNP-ORG).</span>
<span class="c1"># When available, the parser will use a faster and more accurate language model (SLP, SVM, NB, ...).</span>

<span class="c1">#--- LEXICON ---------------------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;;;;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns an iterator over the lines in the file at the given path,</span>
<span class="sd">        strippping comments and decoding each line to Unicode.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="c1"># From file path.</span>
            <span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="c1"># From string.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># From file or buffer.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF8</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">binary_type</span><span class="p">)</span> <span class="k">else</span> <span class="n">line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">decode_utf8</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="p">(</span><span class="n">comment</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">comment</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">line</span>
    <span class="k">return</span>

<span class="k">class</span> <span class="nc">Lexicon</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of known words and their part-of-speech tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arnold NNP x</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)))</span>

<span class="c1">#--- FREQUENCY -------------------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">Frequency</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of words and their relative document frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># and 0.4805</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1">#--- LANGUAGE MODEL --------------------------------------------------------------------------------</span>
<span class="c1"># A language model determines the statistically most probable tag for an unknown word.</span>
<span class="c1"># A pattern.vector Classifier such as SLP can be used to produce a language model,</span>
<span class="c1"># by generalizing patterns from a treebank (i.e., a corpus of hand-tagged texts). </span>
<span class="c1"># For example:</span>
<span class="c1"># &quot;generalizing/VBG from/IN patterns/NNS&quot; and </span>
<span class="c1"># &quot;dancing/VBG with/IN squirrels/NNS&quot;</span>
<span class="c1"># both have a pattern -ing/VBG + [?] + NNS =&gt; IN.</span>
<span class="c1"># Unknown words preceded by -ing and followed by a plural noun will be tagged IN (preposition),</span>
<span class="c1"># unless (put simply) a majority of other patterns learned by the classifier disagrees.</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">classifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">known</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">unknown</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot; A language model using a classifier (e.g., SLP, SVM) trained on morphology and context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pattern.vector</span> <span class="k">import</span> <span class="n">Classifier</span>
            <span class="kn">from</span> <span class="nn">pattern.vector</span> <span class="k">import</span> <span class="n">Perceptron</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
            <span class="kn">from</span> <span class="nn">vector</span> <span class="k">import</span> <span class="n">Classifier</span>
            <span class="kn">from</span> <span class="nn">vector</span> <span class="k">import</span> <span class="n">Perceptron</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>  <span class="o">=</span> <span class="n">path</span>
        <span class="c1"># Use a property instead of a subclass, so users can choose their own classifier.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">classifier</span> <span class="ow">or</span> <span class="n">Perceptron</span><span class="p">()</span>
        <span class="c1"># Parser.lexicon entries can be ambiguous (e.g., about/IN  is RB 25% of the time).</span>
        <span class="c1"># Parser.lexicon entries also in Model.unknown are overruled by the model.</span>
        <span class="c1"># Parser.lexicon entries also in Model.known are not learned by the model</span>
        <span class="c1"># (only their suffix and context is learned, see Model._v() below).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">unknown</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_unknown&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known</span> <span class="o">=</span> <span class="n">known</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexicon</span><span class="o">=</span><span class="p">{},</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;model_unknown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">final</span><span class="p">)</span> <span class="c1"># final = unlink training data (smaller file).</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Trains the model to predict the given tag for the given token,</span>
<span class="sd">            in context of the given previous and next (token, tag)-tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="p">,</span> <span class="nb">next</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the predicted tag for the given token,</span>
<span class="sd">            in context of the given previous and next (token, tag)-tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="p">,</span> <span class="nb">next</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">next</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; Returns a (token, tag)-tuple for the given token,</span>
<span class="sd">            in context of the given previous and next (token, tag)-tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_v</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">previous</span><span class="p">,</span> <span class="nb">next</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a training vector for the given (word, tag)-tuple and its context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s2</span><span class="p">:</span> 
                <span class="n">v</span><span class="p">[</span><span class="n">s1</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">s2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">previous</span><span class="p">,</span> <span class="nb">next</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="k">else</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="k">else</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span>  <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>         <span class="c1"># Bias.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span>  <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    <span class="c1"># Capitalization.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span>  <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known</span> <span class="ow">or</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span>  <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>  <span class="c1"># Word suffix.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>   <span class="c1"># Word suffix left.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;+x&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>   <span class="c1"># Word suffix right.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        <span class="c1"># Tag left.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;-+&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Tag left + right.</span>
        <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;+t&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        <span class="c1"># Tag right.</span>
        <span class="k">return</span> <span class="n">v</span>
        
    <span class="k">def</span> <span class="nf">_get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">description</span>
    <span class="k">def</span> <span class="nf">_set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">s</span>
    
    <span class="n">description</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_description</span><span class="p">,</span> <span class="n">_set_description</span><span class="p">)</span>

<span class="c1">#--- MORPHOLOGICAL RULES ---------------------------------------------------------------------------</span>
<span class="c1"># Brill&#39;s algorithm generates lexical (i.e., morphological) rules in the following format:</span>
<span class="c1"># NN s fhassuf 1 NNS x =&gt; unknown words ending in -s and tagged NN change to NNS.</span>
<span class="c1">#     ly hassuf 2 RB x =&gt; unknown words ending in -ly change to RB.</span>

<span class="k">class</span> <span class="nc">Morphology</span><span class="p">(</span><span class="n">lazylist</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">known</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot; A list of rules based on word morphology (prefix, suffix).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known</span> <span class="o">=</span> <span class="n">known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span>  <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
                <span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="c1"># Word is x.</span>
                <span class="s2">&quot;char&quot;</span><span class="p">,</span> <span class="c1"># Word contains x.</span>
             <span class="s2">&quot;haspref&quot;</span><span class="p">,</span> <span class="c1"># Word starts with x.</span>
              <span class="s2">&quot;hassuf&quot;</span><span class="p">,</span> <span class="c1"># Word end with x.</span>
             <span class="s2">&quot;addpref&quot;</span><span class="p">,</span> <span class="c1"># x + word is in lexicon.</span>
              <span class="s2">&quot;addsuf&quot;</span><span class="p">,</span> <span class="c1"># Word + x is in lexicon.</span>
          <span class="s2">&quot;deletepref&quot;</span><span class="p">,</span> <span class="c1"># Word without x at the start is in lexicon.</span>
           <span class="s2">&quot;deletesuf&quot;</span><span class="p">,</span> <span class="c1"># Word without x at the end is in lexicon.</span>
            <span class="s2">&quot;goodleft&quot;</span><span class="p">,</span> <span class="c1"># Word preceded by word x.</span>
           <span class="s2">&quot;goodright&quot;</span><span class="p">,</span> <span class="c1"># Word followed by word x.</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># [&quot;NN&quot;, &quot;s&quot;, &quot;fhassuf&quot;, &quot;1&quot;, &quot;NNS&quot;, &quot;x&quot;]</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)))</span>
        
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">next</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; Applies lexical rules to the given token, which is a [word, tag] list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span><span class="p">:</span> <span class="c1"># Rule = ly hassuf 2 RB x</span>
                <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span><span class="p">:</span> <span class="c1"># Rule = NN s fhassuf 1 NNS x</span>
                <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span>       <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;char&quot;</span>       <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">w</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;haspref&quot;</span>    <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;hassuf&quot;</span>     <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;addpref&quot;</span>    <span class="ow">and</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;addsuf&quot;</span>     <span class="ow">and</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;deletepref&quot;</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;deletesuf&quot;</span>  <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">known</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;goodleft&quot;</span>   <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">next</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;goodright&quot;</span>  <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span> <span class="n">previous</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">return</span> <span class="n">token</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">affix</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;hassuf&quot;</span><span class="p">,</span> <span class="n">tagged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Inserts a new rule that assigns the given tag to words with the given affix,</span>
<span class="sd">            e.g., Morphology.append(&quot;RB&quot;, &quot;-ly&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">affix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">affix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="n">affix</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">affix</span><span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;char&quot;</span>
        <span class="k">if</span> <span class="n">affix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="n">affix</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">affix</span><span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;hassuf&quot;</span>
        <span class="k">if</span> <span class="n">affix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="n">affix</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">affix</span><span class="p">[</span><span class="o">+</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;haspref&quot;</span>
        <span class="k">if</span> <span class="n">tagged</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">tagged</span><span class="p">,</span> <span class="n">affix</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="o">+</span><span class="n">cmd</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">),</span> <span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">affix</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">),</span> <span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
        <span class="n">lazylist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

<span class="c1">#--- CONTEXT RULES ---------------------------------------------------------------------------------</span>
<span class="c1"># Brill&#39;s algorithm generates contextual rules in the following format:</span>
<span class="c1"># VBD VB PREVTAG TO =&gt; unknown word tagged VBD changes to VB if preceded by a word tagged TO.</span>

<span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="n">lazylist</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of rules based on context (preceding and following words).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
               <span class="s2">&quot;prevtag&quot;</span><span class="p">,</span> <span class="c1"># Preceding word is tagged x.</span>
               <span class="s2">&quot;nexttag&quot;</span><span class="p">,</span> <span class="c1"># Following word is tagged x.</span>
              <span class="s2">&quot;prev2tag&quot;</span><span class="p">,</span> <span class="c1"># Word 2 before is tagged x.</span>
              <span class="s2">&quot;next2tag&quot;</span><span class="p">,</span> <span class="c1"># Word 2 after is tagged x.</span>
           <span class="s2">&quot;prev1or2tag&quot;</span><span class="p">,</span> <span class="c1"># One of 2 preceding words is tagged x.</span>
           <span class="s2">&quot;next1or2tag&quot;</span><span class="p">,</span> <span class="c1"># One of 2 following words is tagged x.</span>
        <span class="s2">&quot;prev1or2or3tag&quot;</span><span class="p">,</span> <span class="c1"># One of 3 preceding words is tagged x.</span>
        <span class="s2">&quot;next1or2or3tag&quot;</span><span class="p">,</span> <span class="c1"># One of 3 following words is tagged x.</span>
           <span class="s2">&quot;surroundtag&quot;</span><span class="p">,</span> <span class="c1"># Preceding word is tagged x and following word is tagged y.</span>
                 <span class="s2">&quot;curwd&quot;</span><span class="p">,</span> <span class="c1"># Current word is x.</span>
                <span class="s2">&quot;prevwd&quot;</span><span class="p">,</span> <span class="c1"># Preceding word is x.</span>
                <span class="s2">&quot;nextwd&quot;</span><span class="p">,</span> <span class="c1"># Following word is x.</span>
            <span class="s2">&quot;prev1or2wd&quot;</span><span class="p">,</span> <span class="c1"># One of 2 preceding words is x.</span>
            <span class="s2">&quot;next1or2wd&quot;</span><span class="p">,</span> <span class="c1"># One of 2 following words is x.</span>
         <span class="s2">&quot;next1or2or3wd&quot;</span><span class="p">,</span> <span class="c1"># One of 3 preceding words is x.</span>
         <span class="s2">&quot;prev1or2or3wd&quot;</span><span class="p">,</span> <span class="c1"># One of 3 following words is x.</span>
             <span class="s2">&quot;prevwdtag&quot;</span><span class="p">,</span> <span class="c1"># Preceding word is x and tagged y.</span>
             <span class="s2">&quot;nextwdtag&quot;</span><span class="p">,</span> <span class="c1"># Following word is x and tagged y.</span>
             <span class="s2">&quot;wdprevtag&quot;</span><span class="p">,</span> <span class="c1"># Current word is y and preceding word is tagged x.</span>
             <span class="s2">&quot;wdnexttag&quot;</span><span class="p">,</span> <span class="c1"># Current word is x and following word is tagged y.</span>
             <span class="s2">&quot;wdand2aft&quot;</span><span class="p">,</span> <span class="c1"># Current word is x and word 2 after is y.</span>
          <span class="s2">&quot;wdand2tagbfr&quot;</span><span class="p">,</span> <span class="c1"># Current word is y and word 2 before is tagged x.</span>
          <span class="s2">&quot;wdand2tagaft&quot;</span><span class="p">,</span> <span class="c1"># Current word is x and word 2 after is tagged y.</span>
               <span class="s2">&quot;lbigram&quot;</span><span class="p">,</span> <span class="c1"># Current word is y and word before is x.</span>
               <span class="s2">&quot;rbigram&quot;</span><span class="p">,</span> <span class="c1"># Current word is x and word after is y.</span>
            <span class="s2">&quot;prevbigram&quot;</span><span class="p">,</span> <span class="c1"># Preceding word is tagged x and word before is tagged y.</span>
            <span class="s2">&quot;nextbigram&quot;</span><span class="p">,</span> <span class="c1"># Following word is tagged x and word after is tagged y.</span>
        <span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># [&quot;VBD&quot;, &quot;VB&quot;, &quot;PREVTAG&quot;, &quot;TO&quot;]</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Applies contextual rules to the given list of tokens,</span>
<span class="sd">            where each token is a [word, tag] list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;STAART&quot;</span><span class="p">,</span> <span class="s2">&quot;STAART&quot;</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># Empty delimiters for look ahead/back.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">o</span> <span class="o">+</span> <span class="n">tokens</span> <span class="o">+</span> <span class="n">o</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STAART&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prevtag&quot;</span>        <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;nexttag&quot;</span>        <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prev2tag&quot;</span>       <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;next2tag&quot;</span>       <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prev1or2tag&quot;</span>    <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;next1or2tag&quot;</span>    <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prev1or2or3tag&quot;</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;next1or2or3tag&quot;</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;surroundtag&quot;</span>    <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;curwd&quot;</span>          <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prevwd&quot;</span>         <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;nextwd&quot;</span>         <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prev1or2wd&quot;</span>     <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;next1or2wd&quot;</span>     <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prevwdtag&quot;</span>      <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;nextwdtag&quot;</span>      <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;wdprevtag&quot;</span>      <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;wdnexttag&quot;</span>      <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;wdand2aft&quot;</span>      <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;wdand2tagbfr&quot;</span>   <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;wdand2tagaft&quot;</span>   <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;lbigram&quot;</span>        <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;rbigram&quot;</span>        <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;prevbigram&quot;</span>     <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;nextbigram&quot;</span>     <span class="ow">and</span> <span class="n">x</span> <span class="o">==</span>  <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">):</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag1</span><span class="p">,</span> <span class="n">tag2</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;prevtag&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Inserts a new rule that updates words with tag1 to tag2,</span>
<span class="sd">            given constraints x and y, e.g., Context.append(&quot;TO &lt; NN&quot;, &quot;VB&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot; &lt; &quot;</span> <span class="ow">in</span> <span class="n">tag1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">y</span><span class="p">:</span>
            <span class="n">tag1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">tag1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &lt; &quot;</span><span class="p">);</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;prevtag&quot;</span>
        <span class="k">if</span> <span class="s2">&quot; &gt; &quot;</span> <span class="ow">in</span> <span class="n">tag1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">y</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">tag1</span> <span class="o">=</span> <span class="n">tag1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &gt; &quot;</span><span class="p">);</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;nexttag&quot;</span>
        <span class="n">lazylist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="n">tag1</span><span class="p">,</span> <span class="n">tag2</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

<span class="c1">#--- NAMED ENTITY RECOGNIZER -----------------------------------------------------------------------</span>

<span class="n">RE_ENTITY1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^http://&quot;</span><span class="p">)</span>                            <span class="c1"># http://www.domain.com/path</span>
<span class="n">RE_ENTITY2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^www\..*?\.[com|org|net|edu|de|uk]$&quot;</span><span class="p">)</span> <span class="c1"># www.domain.com</span>
<span class="n">RE_ENTITY3</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[\w\-\.\+]+@(\w[\w\-]+\.)+[\w\-]+$&quot;</span><span class="p">)</span> <span class="c1"># name@domain.com</span>

<span class="k">class</span> <span class="nc">Entities</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NNP&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of named entities and their labels.</span>
<span class="sd">            For domain names and e-mail adresses, regular expressions are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span>   <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span>  <span class="o">=</span> <span class="p">((</span>
            <span class="s2">&quot;pers&quot;</span><span class="p">,</span> <span class="c1"># Persons: George/NNP-PERS</span>
             <span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="c1"># Locations: Washington/NNP-LOC</span>
             <span class="s2">&quot;org&quot;</span><span class="p">,</span> <span class="c1"># Organizations: Google/NNP-ORG</span>
        <span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># [&quot;Alexander&quot;, &quot;the&quot;, &quot;Great&quot;, &quot;PERS&quot;]</span>
        <span class="c1"># {&quot;alexander&quot;: [[&quot;alexander&quot;, &quot;the&quot;, &quot;great&quot;, &quot;pers&quot;], ...]}</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="nb">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Applies the named entity recognizer to the given list of tokens,</span>
<span class="sd">            where each token is a [word, tag] list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: we could also scan for patterns, e.g.,</span>
        <span class="c1"># &quot;my|his|her name is|was *&quot; =&gt; NNP-PERS.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">RE_ENTITY1</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="n">RE_ENTITY2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="n">RE_ENTITY3</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
                <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
                    <span class="c1"># Look ahead to see if successive words match the named entity.</span>
                    <span class="n">e</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd</span> <span class="k">else</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="k">break</span>
                    <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span>
                            <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tag</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="n">j</span>
                        <span class="k">break</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">tokens</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pers&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Appends a named entity to the lexicon,</span>
<span class="sd">            e.g., Entities.append(&quot;Hooloovoo&quot;, &quot;PERS&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">entity</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="c1">#### PARSER ########################################################################################</span>

<span class="c1">#--- PARSER ----------------------------------------------------------------------------------------</span>
<span class="c1"># A shallow parser can be used to retrieve syntactic-semantic information from text</span>
<span class="c1"># in an efficient way (usually at the expense of deeper configurational syntactic information).</span>
<span class="c1"># The shallow parser in Pattern is meant to handle the following tasks:</span>
<span class="c1"># 1)  Tokenization: split punctuation marks from words and find sentence periods.</span>
<span class="c1"># 2)       Tagging: find the part-of-speech tag of each word (noun, verb, ...) in a sentence.</span>
<span class="c1"># 3)      Chunking: find words that belong together in a phrase.</span>
<span class="c1"># 4) Role labeling: find the subject and object of the sentence.</span>
<span class="c1"># 5) Lemmatization: find the base form of each word (&quot;was&quot; =&gt; &quot;is&quot;).</span>

<span class="c1">#    WORD     TAG     CHUNK      PNP        ROLE        LEMMA</span>
<span class="c1">#------------------------------------------------------------------</span>
<span class="c1">#     The      DT      B-NP        O        NP-SBJ-1      the</span>
<span class="c1">#   black      JJ      I-NP        O        NP-SBJ-1      black</span>
<span class="c1">#     cat      NN      I-NP        O        NP-SBJ-1      cat</span>
<span class="c1">#     sat      VB      B-VP        O        VP-1          sit</span>
<span class="c1">#      on      IN      B-PP      B-PNP      PP-LOC        on</span>
<span class="c1">#     the      DT      B-NP      I-PNP      NP-OBJ-1      the</span>
<span class="c1">#     mat      NN      I-NP      I-PNP      NP-OBJ-1      mat</span>
<span class="c1">#       .      .        O          O          O           .</span>

<span class="c1"># The example demonstrates what information can be retrieved:</span>
<span class="c1">#</span>
<span class="c1"># - the period is split from &quot;mat.&quot; = the end of the sentence,</span>
<span class="c1"># - the words are annotated: NN (noun), VB (verb), JJ (adjective), DT (determiner), ...</span>
<span class="c1"># - the phrases are annotated: NP (noun phrase), VP (verb phrase), PNP (preposition), ...</span>
<span class="c1"># - the phrases are labeled: SBJ (subject), OBJ (object), LOC (location), ...</span>
<span class="c1"># - the phrase start is marked: B (begin), I (inside), O (outside),</span>
<span class="c1"># - the past tense &quot;sat&quot; is lemmatized =&gt; &quot;sit&quot;.</span>

<span class="c1"># By default, the English parser uses the Penn Treebank II tagset:</span>
<span class="c1"># http://www.clips.ua.ac.be/pages/penn-treebank-tagset</span>
<span class="n">PTB</span> <span class="o">=</span> <span class="n">PENN</span> <span class="o">=</span> <span class="s2">&quot;penn&quot;</span>

<span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexicon</span><span class="o">=</span><span class="p">{},</span> <span class="n">frequency</span><span class="o">=</span><span class="p">{},</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;NNP&quot;</span><span class="p">,</span> <span class="s2">&quot;CD&quot;</span><span class="p">),</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot; A simple shallow parser using a Brill-based part-of-speech tagger.</span>
<span class="sd">            The given lexicon is a dictionary of known words and their part-of-speech tag.</span>
<span class="sd">            The given default tags are used for unknown words.</span>
<span class="sd">            Unknown words that start with a capital letter are tagged NNP (except for German).</span>
<span class="sd">            Unknown words that contain only digits and punctuation are tagged CD.</span>
<span class="sd">            Optionally, morphological and contextual rules (or a language model) can be used </span>
<span class="sd">            to improve the tags of unknown words.</span>
<span class="sd">            The given language can be used to discern between</span>
<span class="sd">            Germanic and Romance languages for phrase chunking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexicon</span>    <span class="o">=</span> <span class="n">lexicon</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>  <span class="o">=</span> <span class="n">frequency</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span>      <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">morphology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span>    <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span>   <span class="o">=</span> <span class="n">entities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span>    <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span>   <span class="o">=</span> <span class="n">language</span>
        <span class="c1"># Load data.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">lexicon</span><span class="p">):</span>
            <span class="c1"># Known words.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lexicon</span> <span class="o">=</span> <span class="n">Lexicon</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">lexicon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">frequency</span><span class="p">):</span>
            <span class="c1"># Word frequency.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span> <span class="n">Frequency</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">morphology</span><span class="p">):</span>
            <span class="c1"># Unknown word rules based on word suffix.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">Morphology</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">morphology</span><span class="p">,</span> <span class="n">known</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexicon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
            <span class="c1"># Unknown word rules based on word context.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>
            <span class="c1"># Named entities.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="n">Entities</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">default</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="c1"># Word part-of-speech classifier.</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="c1"># pattern.vector</span>
                <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">find_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a sorted list of keywords in the given string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find_keywords</span><span class="p">(</span><span class="n">string</span><span class="p">,</span>
                     <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                        <span class="n">top</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                  <span class="n">frequency</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">find_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of sentences from the given string.</span>
<span class="sd">            Punctuation marks are separated from each word by a space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># &quot;The cat purs.&quot; =&gt; [&quot;The cat purs .&quot;]</span>
        <span class="k">return</span> <span class="n">find_tokens</span><span class="p">(</span><span class="n">string</span><span class="p">,</span>
                <span class="n">punctuation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>  <span class="s2">&quot;punctuation&quot;</span><span class="p">,</span> <span class="n">PUNCTUATION</span><span class="p">),</span>
              <span class="n">abbreviations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;abbreviations&quot;</span><span class="p">,</span> <span class="n">ABBREVIATIONS</span><span class="p">),</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>      <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="n">replacements</span><span class="p">),</span>
                  <span class="n">linebreak</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\n{2,}&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given list of tokens with part-of-speech tags.</span>
<span class="sd">            Returns a list of tokens, where each token is now a [word, tag]-list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [&quot;The&quot;, &quot;cat&quot;, &quot;purs&quot;] =&gt; [[&quot;The&quot;, &quot;DT&quot;], [&quot;cat&quot;, &quot;NN&quot;], [&quot;purs&quot;, &quot;VB&quot;]]</span>
        <span class="k">return</span> <span class="n">find_tags</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span>
                    <span class="n">lexicon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>   <span class="s2">&quot;lexicon&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexicon</span> <span class="ow">or</span> <span class="p">{}),</span>
                      <span class="n">model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>     <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">),</span>
                 <span class="n">morphology</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;morphology&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">),</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>   <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
                   <span class="n">entities</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>  <span class="s2">&quot;entities&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="p">),</span>
                   <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>  <span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">),</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>   <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">),</span>
                        <span class="nb">map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>       <span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">find_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given list of tokens with chunk tags.</span>
<span class="sd">            Several tags can be added, for example chunk + preposition tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [[&quot;The&quot;, &quot;DT&quot;], [&quot;cat&quot;, &quot;NN&quot;], [&quot;purs&quot;, &quot;VB&quot;]] =&gt;</span>
        <span class="c1"># [[&quot;The&quot;, &quot;DT&quot;, &quot;B-NP&quot;], [&quot;cat&quot;, &quot;NN&quot;, &quot;I-NP&quot;], [&quot;purs&quot;, &quot;VB&quot;, &quot;B-VP&quot;]]</span>
        <span class="k">return</span> <span class="n">find_prepositions</span><span class="p">(</span>
               <span class="n">find_chunks</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span>
                   <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">find_prepositions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given list of tokens with prepositional noun phrase tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find_prepositions</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="c1"># See also Parser.find_chunks().</span>

    <span class="k">def</span> <span class="nf">find_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given list of tokens with verb/predicate tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">find_relations</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_lemmata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given list of tokens with word lemmata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">token</span> <span class="o">+</span> <span class="p">[</span><span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lemmata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a string (sentences) and returns a tagged Unicode string (TaggedString).</span>
<span class="sd">            Sentences in the output are separated by newlines.</span>
<span class="sd">            With tokenize=True, punctuation is split from words and sentences are separated by \n.</span>
<span class="sd">            With tags=True, part-of-speech tags are parsed (NN, VB, IN, ...).</span>
<span class="sd">            With chunks=True, phrase chunk tags are parsed (NP, VP, PP, PNP, ...).</span>
<span class="sd">            With relations=True, semantic role labels are parsed (SBJ, OBJ).</span>
<span class="sd">            With lemmata=True, word lemmata are parsed.</span>
<span class="sd">            Optional parameters are passed to</span>
<span class="sd">            the tokenizer, tagger, chunker, labeler and lemmatizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Tokenizer.</span>
        <span class="k">if</span> <span class="n">tokenize</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_tokens</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="c1"># Unicode.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">decode_string</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="c1"># Tagger (required by chunker, labeler &amp; lemmatizer).</span>
            <span class="k">if</span> <span class="n">tags</span> <span class="ow">or</span> <span class="n">chunks</span> <span class="ow">or</span> <span class="n">relations</span> <span class="ow">or</span> <span class="n">lemmata</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_tags</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">w</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="c1"># Chunker.</span>
            <span class="k">if</span> <span class="n">chunks</span> <span class="ow">or</span> <span class="n">relations</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_chunks</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Labeler.</span>
            <span class="k">if</span> <span class="n">relations</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_labels</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Lemmatizer.</span>
            <span class="k">if</span> <span class="n">lemmata</span><span class="p">:</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lemmata</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Slash-formatted tagged string.</span>
        <span class="c1"># With collapse=False (or split=True), returns raw list</span>
        <span class="c1"># (this output is not usable by tree.Text).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;collapse&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="c1"># Construct TaggedString.format.</span>
        <span class="c1"># (this output is usable by tree.Text).</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;word&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
            <span class="nb">format</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;part-of-speech&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="nb">format</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;chunk&quot;</span><span class="p">,</span> <span class="s2">&quot;preposition&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">relations</span><span class="p">:</span>
            <span class="nb">format</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;relation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lemmata</span><span class="p">:</span>
            <span class="nb">format</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lemma&quot;</span><span class="p">)</span>
        <span class="c1"># Collapse raw list.</span>
        <span class="c1"># Sentences are separated by newlines, tokens by spaces, tags by slashes.</span>
        <span class="c1"># Slashes in words are encoded with &amp;slash;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;slash;&quot;</span><span class="p">)</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">TaggedString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="c1">#--- TAGGED STRING ---------------------------------------------------------------------------------</span>
<span class="c1"># Pattern.parse() returns a TaggedString: a Unicode string with &quot;tags&quot; and &quot;language&quot; attributes.</span>
<span class="c1"># The pattern.text.tree.Text class uses this attribute to determine the token format and</span>
<span class="c1"># transform the tagged string to a parse tree of nested Sentence, Chunk and Word objects.</span>

<span class="n">TOKENS</span> <span class="o">=</span> <span class="s2">&quot;tokens&quot;</span>

<span class="k">class</span> <span class="nc">TaggedString</span><span class="p">(</span><span class="n">unicode</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;word&quot;</span><span class="p">],</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Unicode string with tags and language attributes.</span>
<span class="sd">            For example: TaggedString(&quot;cat/NN/NP&quot;, tags=[&quot;word&quot;, &quot;pos&quot;, &quot;chunk&quot;]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># From a TaggedString:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">):</span>
            <span class="n">tags</span><span class="p">,</span> <span class="n">language</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">language</span>
        <span class="c1"># From a TaggedString.split(TOKENS) list:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;slash;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">token</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">string</span><span class="p">]</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">string</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">unicode</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">TOKENS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of sentences, where each sentence is a list of tokens,</span>
<span class="sd">            where each token is a list of word + tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sep</span> <span class="o">!=</span> <span class="n">TOKENS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unicode</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[[[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;slash;&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">unicode</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>

<span class="c1">#--- UNIVERSAL TAGSET ------------------------------------------------------------------------------</span>
<span class="c1"># The default part-of-speech tagset used in Pattern is Penn Treebank II.</span>
<span class="c1"># However, not all languages are well-suited to Penn Treebank (which was developed for English).</span>
<span class="c1"># As more languages are implemented, this is becoming more problematic.</span>
<span class="c1">#</span>
<span class="c1"># A universal tagset is proposed by Slav Petrov (2012):</span>
<span class="c1"># http://www.petrovi.de/data/lrec.pdf</span>
<span class="c1">#</span>
<span class="c1"># Subclasses of Parser should start implementing</span>
<span class="c1"># Parser.parse(tagset=UNIVERSAL) with a simplified tagset.</span>
<span class="c1"># The names of the constants correspond to Petrov&#39;s naming scheme, while</span>
<span class="c1"># the value of the constants correspond to Penn Treebank.</span>

<span class="n">UNIVERSAL</span> <span class="o">=</span> <span class="s2">&quot;universal&quot;</span>

<span class="n">NOUN</span><span class="p">,</span> <span class="n">VERB</span><span class="p">,</span> <span class="n">ADJ</span><span class="p">,</span> <span class="n">ADV</span><span class="p">,</span> <span class="n">PRON</span><span class="p">,</span> <span class="n">DET</span><span class="p">,</span> <span class="n">PREP</span><span class="p">,</span> <span class="n">ADP</span><span class="p">,</span> <span class="n">NUM</span><span class="p">,</span> <span class="n">CONJ</span><span class="p">,</span> <span class="n">INTJ</span><span class="p">,</span> <span class="n">PRT</span><span class="p">,</span> <span class="n">PUNC</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> \
    <span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;VB&quot;</span><span class="p">,</span> <span class="s2">&quot;JJ&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;PR&quot;</span><span class="p">,</span> <span class="s2">&quot;DT&quot;</span><span class="p">,</span> <span class="s2">&quot;PP&quot;</span><span class="p">,</span> <span class="s2">&quot;PP&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">,</span> <span class="s2">&quot;CJ&quot;</span><span class="p">,</span> <span class="s2">&quot;UH&quot;</span><span class="p">,</span> <span class="s2">&quot;PT&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span>

<span class="k">def</span> <span class="nf">penntreebank2universal</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a (token, tag)-tuple with a simplified universal part-of-speech tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;NNP-&quot;</span><span class="p">,</span> <span class="s2">&quot;NNPS-&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">NOUN</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;NNS&quot;</span><span class="p">,</span> <span class="s2">&quot;NNP&quot;</span><span class="p">,</span> <span class="s2">&quot;NNPS&quot;</span><span class="p">,</span> <span class="s2">&quot;NP&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">NOUN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;MD&quot;</span><span class="p">,</span> <span class="s2">&quot;VB&quot;</span><span class="p">,</span> <span class="s2">&quot;VBD&quot;</span><span class="p">,</span> <span class="s2">&quot;VBG&quot;</span><span class="p">,</span> <span class="s2">&quot;VBN&quot;</span><span class="p">,</span> <span class="s2">&quot;VBP&quot;</span><span class="p">,</span> <span class="s2">&quot;VBZ&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">VERB</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;JJ&quot;</span><span class="p">,</span> <span class="s2">&quot;JJR&quot;</span><span class="p">,</span> <span class="s2">&quot;JJS&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">ADJ</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="s2">&quot;RBR&quot;</span><span class="p">,</span> <span class="s2">&quot;RBS&quot;</span><span class="p">,</span> <span class="s2">&quot;WRB&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">ADV</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;PRP&quot;</span><span class="p">,</span> <span class="s2">&quot;PRP$&quot;</span><span class="p">,</span> <span class="s2">&quot;WP&quot;</span><span class="p">,</span> <span class="s2">&quot;WP$&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">PRON</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DT&quot;</span><span class="p">,</span> <span class="s2">&quot;PDT&quot;</span><span class="p">,</span> <span class="s2">&quot;WDT&quot;</span><span class="p">,</span> <span class="s2">&quot;EX&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">DET</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;IN&quot;</span><span class="p">,):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">PREP</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CD&quot;</span><span class="p">,):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">NUM</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CC&quot;</span><span class="p">,):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">CONJ</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;UH&quot;</span><span class="p">,):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">INTJ</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;RP&quot;</span><span class="p">,</span> <span class="s2">&quot;TO&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">PRT</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;SYM&quot;</span><span class="p">,</span> <span class="s2">&quot;LS&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;$&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">PUNC</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

<span class="c1">#--- TOKENIZER -------------------------------------------------------------------------------------</span>

<span class="n">TOKEN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\S+)\s&quot;</span><span class="p">)</span>

<span class="c1"># Handle common punctuation marks.</span>
<span class="n">PUNCTUATION</span> <span class="o">=</span> \
<span class="n">punctuation</span> <span class="o">=</span> <span class="s2">&quot;.,;:!?()[]</span><span class="si">{}</span><span class="s2">`&#39;&#39;</span><span class="se">\&quot;</span><span class="s2">@#$^&amp;*+-|=~_&quot;</span>

<span class="c1"># Handle common abbreviations.</span>
<span class="n">ABBREVIATIONS</span> <span class="o">=</span> <span class="n">abbreviations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
    <span class="s2">&quot;a.&quot;</span><span class="p">,</span> <span class="s2">&quot;adj.&quot;</span><span class="p">,</span> <span class="s2">&quot;adv.&quot;</span><span class="p">,</span> <span class="s2">&quot;al.&quot;</span><span class="p">,</span> <span class="s2">&quot;a.m.&quot;</span><span class="p">,</span> <span class="s2">&quot;art.&quot;</span><span class="p">,</span> <span class="s2">&quot;c.&quot;</span><span class="p">,</span> <span class="s2">&quot;capt.&quot;</span><span class="p">,</span> <span class="s2">&quot;cert.&quot;</span><span class="p">,</span> <span class="s2">&quot;cf.&quot;</span><span class="p">,</span> <span class="s2">&quot;col.&quot;</span><span class="p">,</span> <span class="s2">&quot;Col.&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;comp.&quot;</span><span class="p">,</span> <span class="s2">&quot;conf.&quot;</span><span class="p">,</span> <span class="s2">&quot;def.&quot;</span><span class="p">,</span> <span class="s2">&quot;Dep.&quot;</span><span class="p">,</span> <span class="s2">&quot;Dept.&quot;</span><span class="p">,</span> <span class="s2">&quot;Dr.&quot;</span><span class="p">,</span> <span class="s2">&quot;dr.&quot;</span><span class="p">,</span> <span class="s2">&quot;ed.&quot;</span><span class="p">,</span> <span class="s2">&quot;e.g.&quot;</span><span class="p">,</span> <span class="s2">&quot;esp.&quot;</span><span class="p">,</span> <span class="s2">&quot;etc.&quot;</span><span class="p">,</span> <span class="s2">&quot;ex.&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;f.&quot;</span><span class="p">,</span> <span class="s2">&quot;fig.&quot;</span><span class="p">,</span> <span class="s2">&quot;gen.&quot;</span><span class="p">,</span> <span class="s2">&quot;id.&quot;</span><span class="p">,</span> <span class="s2">&quot;i.e.&quot;</span><span class="p">,</span> <span class="s2">&quot;int.&quot;</span><span class="p">,</span> <span class="s2">&quot;l.&quot;</span><span class="p">,</span> <span class="s2">&quot;m.&quot;</span><span class="p">,</span> <span class="s2">&quot;Med.&quot;</span><span class="p">,</span> <span class="s2">&quot;Mil.&quot;</span><span class="p">,</span> <span class="s2">&quot;Mr.&quot;</span><span class="p">,</span> <span class="s2">&quot;n.&quot;</span><span class="p">,</span> <span class="s2">&quot;n.q.&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;orig.&quot;</span><span class="p">,</span> <span class="s2">&quot;pl.&quot;</span><span class="p">,</span> <span class="s2">&quot;pred.&quot;</span><span class="p">,</span> <span class="s2">&quot;pres.&quot;</span><span class="p">,</span> <span class="s2">&quot;p.m.&quot;</span><span class="p">,</span> <span class="s2">&quot;ref.&quot;</span><span class="p">,</span> <span class="s2">&quot;v.&quot;</span><span class="p">,</span> <span class="s2">&quot;vs.&quot;</span><span class="p">,</span> <span class="s2">&quot;w/&quot;</span>
<span class="p">))</span>

<span class="n">RE_ABBR1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[A-Za-z]\.$&quot;</span><span class="p">)</span>       <span class="c1"># single letter, &quot;T. De Smedt&quot;</span>
<span class="n">RE_ABBR2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^([A-Za-z]\.)+$&quot;</span><span class="p">)</span>    <span class="c1"># alternating letters, &quot;U.S.&quot;</span>
<span class="n">RE_ABBR3</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[A-Z][&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="c1"># capital followed by consonants, &quot;Mr.&quot;</span>
        <span class="s2">&quot;bcdfghjklmnpqrstvwxz&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]+.$&quot;</span><span class="p">)</span>

<span class="c1"># Handle emoticons.</span>
<span class="n">EMOTICONS</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># (facial expression, sentiment)-keys</span>
    <span class="p">(</span><span class="s2">&quot;love&quot;</span> <span class="p">,</span> <span class="o">+</span><span class="mf">1.00</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&lt;3&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;♥&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;❤&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;grin&quot;</span> <span class="p">,</span> <span class="o">+</span><span class="mf">1.00</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:D&quot;</span><span class="p">,</span> <span class="s2">&quot;:-D&quot;</span><span class="p">,</span> <span class="s2">&quot;:D&quot;</span><span class="p">,</span> <span class="s2">&quot;=-D&quot;</span><span class="p">,</span> <span class="s2">&quot;=D&quot;</span><span class="p">,</span> <span class="s2">&quot;X-D&quot;</span><span class="p">,</span> <span class="s2">&quot;x-D&quot;</span><span class="p">,</span> <span class="s2">&quot;XD&quot;</span><span class="p">,</span> <span class="s2">&quot;xD&quot;</span><span class="p">,</span> <span class="s2">&quot;8-D&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;taunt&quot;</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.75</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:P&quot;</span><span class="p">,</span> <span class="s2">&quot;:-P&quot;</span><span class="p">,</span> <span class="s2">&quot;:P&quot;</span><span class="p">,</span> <span class="s2">&quot;:-p&quot;</span><span class="p">,</span> <span class="s2">&quot;:p&quot;</span><span class="p">,</span> <span class="s2">&quot;:-b&quot;</span><span class="p">,</span> <span class="s2">&quot;:b&quot;</span><span class="p">,</span> <span class="s2">&quot;:c)&quot;</span><span class="p">,</span> <span class="s2">&quot;:o)&quot;</span><span class="p">,</span> <span class="s2">&quot;:^)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;smile&quot;</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.50</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:)&quot;</span><span class="p">,</span> <span class="s2">&quot;:-)&quot;</span><span class="p">,</span> <span class="s2">&quot;:)&quot;</span><span class="p">,</span> <span class="s2">&quot;=)&quot;</span><span class="p">,</span> <span class="s2">&quot;=]&quot;</span><span class="p">,</span> <span class="s2">&quot;:]&quot;</span><span class="p">,</span> <span class="s2">&quot;:}&quot;</span><span class="p">,</span> <span class="s2">&quot;:&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;:3&quot;</span><span class="p">,</span> <span class="s2">&quot;8)&quot;</span><span class="p">,</span> <span class="s2">&quot;8-)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;wink&quot;</span> <span class="p">,</span> <span class="o">+</span><span class="mf">0.25</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;;]&quot;</span><span class="p">,</span> <span class="s2">&quot;;-)&quot;</span><span class="p">,</span> <span class="s2">&quot;;)&quot;</span><span class="p">,</span> <span class="s2">&quot;;-]&quot;</span><span class="p">,</span> <span class="s2">&quot;;]&quot;</span><span class="p">,</span> <span class="s2">&quot;;D&quot;</span><span class="p">,</span> <span class="s2">&quot;;^)&quot;</span><span class="p">,</span> <span class="s2">&quot;*-)&quot;</span><span class="p">,</span> <span class="s2">&quot;*)&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;gasp&quot;</span> <span class="p">,</span> <span class="o">+</span><span class="mf">0.05</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:o&quot;</span><span class="p">,</span> <span class="s2">&quot;:-O&quot;</span><span class="p">,</span> <span class="s2">&quot;:O&quot;</span><span class="p">,</span> <span class="s2">&quot;:o&quot;</span><span class="p">,</span> <span class="s2">&quot;:-o&quot;</span><span class="p">,</span> <span class="s2">&quot;o_O&quot;</span><span class="p">,</span> <span class="s2">&quot;o.O&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;°O°&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;°o°&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;worry&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:/&quot;</span><span class="p">,</span>  <span class="s2">&quot;:-/&quot;</span><span class="p">,</span> <span class="s2">&quot;:/&quot;</span><span class="p">,</span> <span class="s2">&quot;:</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;:</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;:-.&quot;</span><span class="p">,</span> <span class="s2">&quot;:-s&quot;</span><span class="p">,</span> <span class="s2">&quot;:s&quot;</span><span class="p">,</span> <span class="s2">&quot;:S&quot;</span><span class="p">,</span> <span class="s2">&quot;:-S&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;.&gt;&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;frown&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;&gt;:[&quot;</span><span class="p">,</span> <span class="s2">&quot;:-(&quot;</span><span class="p">,</span> <span class="s2">&quot;:(&quot;</span><span class="p">,</span> <span class="s2">&quot;=(&quot;</span><span class="p">,</span> <span class="s2">&quot;:-[&quot;</span><span class="p">,</span> <span class="s2">&quot;:[&quot;</span><span class="p">,</span> <span class="s2">&quot;:{&quot;</span><span class="p">,</span> <span class="s2">&quot;:-&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;:c&quot;</span><span class="p">,</span> <span class="s2">&quot;:-c&quot;</span><span class="p">,</span> <span class="s2">&quot;=/&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;cry&quot;</span>  <span class="p">,</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">):</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;:&#39;(&quot;</span><span class="p">,</span> <span class="s2">&quot;:&#39;&#39;&#39;(&quot;</span><span class="p">,</span> <span class="s2">&quot;;&#39;(&quot;</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">RE_EMOTICONS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot; ?&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">EMOTICONS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
<span class="n">RE_EMOTICONS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)($|\s)&quot;</span> <span class="o">%</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RE_EMOTICONS</span><span class="p">))</span>

<span class="c1"># Handle sarcasm punctuation (!).</span>
<span class="n">RE_SARCASM</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\( ?\! ?\)&quot;</span><span class="p">)</span>

<span class="c1"># Handle common contractions.</span>
<span class="n">replacements</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s2">&quot;&#39;d&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;d&quot;</span><span class="p">,</span>
     <span class="s2">&quot;&#39;m&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;m&quot;</span><span class="p">,</span>
     <span class="s2">&quot;&#39;s&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;ll&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;ll&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;re&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;re&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;ve&quot;</span><span class="p">:</span> <span class="s2">&quot; &#39;ve&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n&#39;t&quot;</span><span class="p">:</span> <span class="s2">&quot; n&#39;t&quot;</span>
<span class="p">}</span>

<span class="c1"># Handle paragraph line breaks (\n\n marks end of sentence).</span>
<span class="n">EOS</span> <span class="o">=</span> <span class="s2">&quot;END-OF-SENTENCE&quot;</span>

<span class="k">def</span> <span class="nf">find_tokens</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">punctuation</span><span class="o">=</span><span class="n">PUNCTUATION</span><span class="p">,</span> <span class="n">abbreviations</span><span class="o">=</span><span class="n">ABBREVIATIONS</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">replacements</span><span class="p">,</span> <span class="n">linebreak</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\n{2,}&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a list of sentences. Each sentence is a space-separated string of tokens (words).</span>
<span class="sd">        Handles common cases of abbreviations (e.g., etc., ...).</span>
<span class="sd">        Punctuation marks are split from other words. Periods (or ?!) mark the end of a sentence.</span>
<span class="sd">        Headings without an ending period are inferred by line breaks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Handle periods separately.</span>
    <span class="n">punctuation</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">punctuation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="c1"># Handle replacements (contractions).</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">replace</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="c1"># Handle Unicode quotes.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;“&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot; “ &quot;</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;”&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot; ” &quot;</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;‘&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot; ‘ &quot;</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;’&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot; ’ &quot;</span><span class="p">)</span>
    <span class="c1"># Collapse whitespace.</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">linebreak</span><span class="p">,</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">EOS</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Handle punctuation marks.</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TOKEN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">t</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="ow">and</span> \
              <span class="ow">not</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">replace</span><span class="p">:</span>
                <span class="c1"># Split leading punctuation.</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">punctuation</span><span class="p">):</span>
                    <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">while</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">punctuation</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,))</span> <span class="ow">and</span> \
              <span class="ow">not</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">replace</span><span class="p">:</span>
                <span class="c1"># Split trailing punctuation.</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">punctuation</span><span class="p">):</span>
                    <span class="n">tail</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Split ellipsis (...) before splitting period.</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">):</span>
                    <span class="n">tail</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="c1"># Split period (if not an abbreviation).</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">abbreviations</span> <span class="ow">or</span> \
                      <span class="n">RE_ABBR1</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
                      <span class="n">RE_ABBR2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
                      <span class="n">RE_ABBR3</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tail</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">tokens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">tail</span><span class="p">))</span>
    <span class="c1"># Handle sentence breaks (periods, quotes, parenthesis).</span>
    <span class="n">sentences</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="p">[[]],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">EOS</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> \
              <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;”&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;’&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">EOS</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sentences</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># Balanced quotes.</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sentences</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">EOS</span><span class="p">)</span>
            <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Handle emoticons.</span>
    <span class="n">sentences</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">(</span><span class="n">RE_SARCASM</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;(!)&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">)</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">RE_EMOTICONS</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sentences</span>

<span class="c1">#--- PART-OF-SPEECH TAGGER -------------------------------------------------------------------------</span>

<span class="c1"># Unknown words are recognized as numbers if they contain only digits and -,.:/%$</span>
<span class="n">CD</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[0-9\-\,\.\:\/\%\$]+$&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_suffix_rules</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;NN&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Default morphological tagging rules for English, based on word suffixes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">token</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">token</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ing&quot;</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;VBG&quot;</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ly&quot;</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;RB&quot;</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;ous&quot;</span><span class="p">,</span> <span class="s2">&quot;ss&quot;</span><span class="p">)):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;NNS&quot;</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;able&quot;</span><span class="p">,</span> <span class="s2">&quot;al&quot;</span><span class="p">,</span> <span class="s2">&quot;ful&quot;</span><span class="p">,</span> <span class="s2">&quot;ible&quot;</span><span class="p">,</span> <span class="s2">&quot;ient&quot;</span><span class="p">,</span> <span class="s2">&quot;ish&quot;</span><span class="p">,</span> <span class="s2">&quot;ive&quot;</span><span class="p">,</span> <span class="s2">&quot;less&quot;</span><span class="p">,</span> <span class="s2">&quot;tic&quot;</span><span class="p">,</span> <span class="s2">&quot;ous&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">token</span><span class="p">:</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;JJ&quot;</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ed&quot;</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;VBN&quot;</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;ate&quot;</span><span class="p">,</span> <span class="s2">&quot;ify&quot;</span><span class="p">,</span> <span class="s2">&quot;ise&quot;</span><span class="p">,</span> <span class="s2">&quot;ize&quot;</span><span class="p">)):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;VBP&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">find_tags</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">lexicon</span><span class="o">=</span><span class="p">{},</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;NNP&quot;</span><span class="p">,</span> <span class="s2">&quot;CD&quot;</span><span class="p">),</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a list of [token, tag]-items for the given list of tokens:</span>
<span class="sd">        [&quot;The&quot;, &quot;cat&quot;, &quot;purs&quot;] =&gt; [[&quot;The&quot;, &quot;DT&quot;], [&quot;cat&quot;, &quot;NN&quot;], [&quot;purs&quot;, &quot;VB&quot;]]</span>
<span class="sd">        Words are tagged using the given lexicon of (word, tag)-items.</span>
<span class="sd">        Unknown words are tagged NN by default.</span>
<span class="sd">        Unknown words that start with a capital letter are tagged NNP (unless language=&quot;de&quot;).</span>
<span class="sd">        Unknown words that consist only of digits and punctuation marks are tagged CD.</span>
<span class="sd">        Unknown words are then improved with morphological rules.</span>
<span class="sd">        All words are improved with contextual rules.</span>
<span class="sd">        If a model is given, uses model for unknown words instead of morphology and context.</span>
<span class="sd">        If map is a function, it is applied to each (token, tag) after applying all rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tagged</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Tag known words.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
        <span class="n">tagged</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">token</span><span class="p">,</span> <span class="n">lexicon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lexicon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)])</span>
    <span class="c1"># Tag unknown words.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tagged</span><span class="p">):</span>
        <span class="n">prev</span><span class="p">,</span> <span class="nb">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tagged</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">token</span> <span class="ow">in</span> <span class="p">(</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">unknown</span> <span class="ow">or</span> <span class="p">()):</span>
            <span class="c1"># Use language model (i.e., SLP).</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">apply</span><span class="p">([</span><span class="n">token</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">prev</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
            <span class="c1"># Use NNP for capitalized words (except in German).</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">istitle</span><span class="p">()</span> <span class="ow">and</span> <span class="n">language</span> <span class="o">!=</span> <span class="s2">&quot;de&quot;</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># Use CD for digits and numbers.</span>
            <span class="k">elif</span> <span class="n">CD</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="c1"># Use suffix rules (e.g., -ly = RB).</span>
            <span class="k">elif</span> <span class="n">morphology</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">apply</span><span class="p">([</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">prev</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
            <span class="c1"># Use suffix rules (English default).</span>
            <span class="k">elif</span> <span class="n">language</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_suffix_rules</span><span class="p">([</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="c1"># Use most frequent tag (NN).</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tagged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># Tag words by context.</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tagged</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">tagged</span><span class="p">)</span>
    <span class="c1"># Tag named entities.</span>
    <span class="k">if</span> <span class="n">entities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tagged</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">tagged</span><span class="p">)</span>
    <span class="c1"># Map tags with a custom function.</span>
    <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tagged</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span> <span class="ow">or</span> <span class="p">[</span><span class="n">token</span><span class="p">,</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tagged</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tagged</span>

<span class="c1">#--- PHRASE CHUNKER --------------------------------------------------------------------------------</span>

<span class="n">SEPARATOR</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>

<span class="n">NN</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;NN|NNS|NNP|NNPS|NNPS?\-[A-Z]{3,4}|PR|PRP|PRP\$&quot;</span>
<span class="n">VB</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;VB|VBD|VBG|VBN|VBP|VBZ&quot;</span>
<span class="n">JJ</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;JJ|JJR|JJS&quot;</span>
<span class="n">RB</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?&lt;!W)RB|RBR|RBS&quot;</span>
<span class="n">CC</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;CC|CJ&quot;</span>

<span class="c1"># Chunking rules.</span>
<span class="c1"># CHUNKS[0] = Germanic: RB + JJ precedes NN (&quot;the round table&quot;).</span>
<span class="c1"># CHUNKS[1] = Romance: RB + JJ precedes or follows NN (&quot;la table ronde&quot;, &quot;une jolie fille&quot;).</span>
<span class="n">CHUNKS</span> <span class="o">=</span> <span class="p">[[</span>
    <span class="c1"># Germanic languages: en, de, nl, ...</span>
    <span class="p">(</span>  <span class="s2">&quot;NP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((NN)/)* ((DT|CD|CC)/)* ((RB|JJ)/)* (((JJ)/(CC|,)/)*(JJ)/)* ((NN)/)+&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;VP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;(((MD|TO|RB)/)* ((VB)/)+ ((RP)/)*)+&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;VP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((MD)/)&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;PP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((IN|PP)/)+&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ADJP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((RB|JJ)/)* ((JJ)/,/)* ((JJ)/(CC)/)* ((JJ)/)+&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ADVP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((RB)/)+&quot;</span><span class="p">),</span>
<span class="p">],</span> <span class="p">[</span>
    <span class="c1"># Romance languages: es, fr, it, ...</span>
    <span class="p">(</span>  <span class="s2">&quot;NP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((NN)/)* ((DT|CD|CC)/)* ((RB|JJ|,)/)* (((JJ)/(CC|,)/)*(JJ)/)* ((NN)/)+ ((RB|JJ)/)*&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;VP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;(((MD|TO|RB)/)* ((VB)/)+ ((RP)/)* ((RB)/)*)+&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;VP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((MD)/)&quot;</span><span class="p">),</span>
    <span class="p">(</span>  <span class="s2">&quot;PP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((IN|PP)/)+&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ADJP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((RB|JJ)/)* ((JJ)/,/)* ((JJ)/(CC)/)* ((JJ)/)+&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ADVP&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;((RB)/)+&quot;</span><span class="p">),</span>
<span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">CHUNKS</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="n">NN</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;VB&quot;</span><span class="p">,</span> <span class="n">VB</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;JJ&quot;</span><span class="p">,</span> <span class="n">JJ</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">,</span> <span class="n">RB</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">CHUNKS</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="c1"># Handle ADJP before VP, </span>
<span class="c1"># so that RB prefers next ADJP over previous VP.</span>
<span class="n">CHUNKS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">CHUNKS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">CHUNKS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">CHUNKS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">find_chunks</span><span class="p">(</span><span class="n">tagged</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The input is a list of [token, tag]-items.</span>
<span class="sd">        The output is a list of [token, tag, chunk]-items:</span>
<span class="sd">        The/DT nice/JJ fish/NN is/VBZ dead/JJ ./. =&gt;</span>
<span class="sd">        The/DT/B-NP nice/JJ/I-NP fish/NN/I-NP is/VBZ/B-VP dead/JJ/B-ADJP ././O</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chunked</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tagged</span><span class="p">]</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">SEPARATOR</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tagged</span><span class="p">)</span>
    <span class="c1"># Use Germanic or Romance chunking rules according to given language.</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">CHUNKS</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">language</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ca&quot;</span><span class="p">,</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;fr&quot;</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">))]:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
            <span class="c1"># Find the start of chunks inside the tags-string.</span>
            <span class="c1"># Number of preceding separators = number of preceding tokens.</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">tags</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">SEPARATOR</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">SEPARATOR</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1"># A conjunction or comma cannot be start of a chunk.</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">chunked</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CJ&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">):</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Mark first token in chunk with B-.</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">chunked</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;B-&quot;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">)</span>
                    <span class="c1"># Mark other tokens in chunk with I-.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">chunked</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;I-&quot;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">)</span>
    <span class="c1"># Mark chinks (tokens outside of a chunk) with O-.</span>
    <span class="k">for</span> <span class="n">chink</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="n">chunked</span><span class="p">):</span>
        <span class="n">chink</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
    <span class="c1"># Post-processing corrections.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunked</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chunk</span> <span class="o">==</span> <span class="s2">&quot;B-NP&quot;</span><span class="p">:</span>
            <span class="c1"># &quot;Perhaps you&quot; =&gt; ADVP + NP</span>
            <span class="c1"># &quot;Really nice work&quot; =&gt; NP</span>
            <span class="c1"># &quot;Really, nice work&quot; =&gt; ADVP + O + NP</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;JJ&quot;</span><span class="p">):</span>
                <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;B-ADVP&quot;</span>
                <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;B-NP&quot;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CJ&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">):</span>
                <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;O&quot;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
                <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;B-NP&quot;</span>
    <span class="k">return</span> <span class="n">chunked</span>

<span class="k">def</span> <span class="nf">find_prepositions</span><span class="p">(</span><span class="n">chunked</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The input is a list of [token, tag, chunk]-items.</span>
<span class="sd">        The output is a list of [token, tag, chunk, preposition]-items.</span>
<span class="sd">        PP-chunks followed by NP-chunks make up a PNP-chunk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Tokens that are not part of a preposition just get the O-tag.</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunked</span><span class="p">:</span>
        <span class="n">ch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunked</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;PP&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
            <span class="c1"># Find PP followed by other PP, NP with nouns and pronouns, VP with a gerund.</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunked</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> \
             <span class="p">(</span><span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;NP&quot;</span><span class="p">,</span> <span class="s2">&quot;PP&quot;</span><span class="p">))</span> <span class="ow">or</span> \
              <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;VBG&quot;</span><span class="p">,</span> <span class="s2">&quot;VBN&quot;</span><span class="p">)):</span>
                <span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;B-PNP&quot;</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chunked</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;NP&quot;</span><span class="p">,</span> <span class="s2">&quot;PP&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;VBG&quot;</span><span class="p">,</span> <span class="s2">&quot;VBN&quot;</span><span class="p">)):</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;PP&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pp</span><span class="p">:</span>
                        <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I-PNP&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;PP&quot;</span><span class="p">):</span>
                        <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I-PNP&quot;</span>
                        <span class="n">pp</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">chunked</span>

<span class="c1">#--- SEMANTIC ROLE LABELER -------------------------------------------------------------------------</span>
<span class="c1"># Naive approach.</span>

<span class="n">BE</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">((</span><span class="s2">&quot;be&quot;</span><span class="p">,</span> <span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;are&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;being&quot;</span><span class="p">,</span> <span class="s2">&quot;was&quot;</span><span class="p">,</span> <span class="s2">&quot;were&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">GO</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">((</span><span class="s2">&quot;go&quot;</span><span class="p">,</span> <span class="s2">&quot;goes&quot;</span><span class="p">,</span> <span class="s2">&quot;going&quot;</span><span class="p">,</span> <span class="s2">&quot;went&quot;</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_relations</span><span class="p">(</span><span class="n">chunked</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The input is a list of [token, tag, chunk]-items.</span>
<span class="sd">        The output is a list of [token, tag, chunk, relation]-items.</span>
<span class="sd">        A noun phrase preceding a verb phrase is perceived as sentence subject.</span>
<span class="sd">        A noun phrase following a verb phrase is perceived as sentence object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">token</span><span class="p">:</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># B-NP =&gt; NP</span>
    <span class="c1"># Group successive tokens with the same chunk-tag.</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">chunked</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> \
        <span class="ow">or</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;B-&quot;</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="n">tag</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tag</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">])</span>
    <span class="c1"># If a VP is preceded by a NP, the NP is tagged as NP-SBJ-(id).</span>
    <span class="c1"># If a VP is followed by a NP, the NP is tagged as NP-OBJ-(id).</span>
    <span class="c1"># Chunks that are not part of a relation get an O-tag.</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;VP&quot;</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;NP&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VP-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;*NP-SBJ-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;O-*&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;VP&quot;</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;NP&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VP-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*NP-OBJ-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;O-*&quot;</span><span class="p">)</span>
    <span class="c1"># This is more a proof-of-concept than useful in practice:</span>
    <span class="c1"># PP-LOC = be + in|at + the|my</span>
    <span class="c1"># PP-DIR = go + to|towards + the|my</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">chunk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span><span class="p">:</span>
            <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># previous / current / next</span>
            <span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;PP&quot;</span> <span class="ow">and</span> <span class="n">t2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DT&quot;</span><span class="p">,</span> <span class="s2">&quot;PR&quot;</span><span class="p">,</span> <span class="s2">&quot;PRP$&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">BE</span> <span class="ow">and</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;at&quot;</span><span class="p">)</span>      <span class="p">:</span> <span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PP-LOC&quot;</span>
                <span class="k">if</span> <span class="n">t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">GO</span> <span class="ow">and</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;towards&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PP-DIR&quot;</span>
    <span class="n">related</span> <span class="o">=</span> <span class="p">[];</span> <span class="p">[</span><span class="n">related</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">related</span>

<span class="c1">#--- KEYWORDS EXTRACTION ---------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">find_keywords</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a sorted list of keywords in the given string.</span>
<span class="sd">        The given parser (e.g., pattern.en.parser) is used to identify noun phrases.</span>
<span class="sd">        The given frequency dictionary can be a reference corpus,</span>
<span class="sd">        with relative document frequency (df, 0.0-1.0) for each lemma, </span>
<span class="sd">        e.g., {&quot;the&quot;: 0.8, &quot;cat&quot;: 0.1, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lemmata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lemmata&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stem&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="c1"># Parse the string and extract noun phrases (NP).</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wordcount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lemmata</span><span class="o">=</span><span class="n">lemmata</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span> <span class="c1"># [&quot;cats&quot;, &quot;NNS&quot;, &quot;I-NP&quot;, &quot;O&quot;, &quot;cat&quot;]</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;B-NP&quot;</span><span class="p">:</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">w</span><span class="p">])</span>
                <span class="n">wordcount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;I-NP&quot;</span> <span class="ow">and</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NNP&quot;</span><span class="p">:</span>
                <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Collapse NNPs: &quot;Ms Kitty&quot;.</span>
                <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;I-NP&quot;</span><span class="p">:</span>
                <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="n">wordcount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Rate the nouns in noun phrases.</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
        <span class="n">head</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">language</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ca&quot;</span><span class="p">,</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;fr&quot;</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">):</span>
            <span class="c1"># Head of &quot;cat hair&quot; =&gt; &quot;hair&quot;.</span>
            <span class="c1"># Head of &quot;poils de chat&quot; =&gt; &quot;poils&quot;.</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NN&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lemmata</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
                <span class="c1"># Higher score for chunks that appear more frequently.</span>
                <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">wordcount</span><span class="p">)</span>
                <span class="c1"># Higher score for chunks that appear in more contexts (semantic centrality).</span>
                <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chunk</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="c1"># Higher score for chunks at the start (25%) of the text.</span>
                <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.25</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="c1"># Higher score for chunks not in a prepositional phrase.</span>
                <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;O&quot;</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="c1"># Higher score for chunk head.</span>
                <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">head</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">head</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Rate tf-idf if a frequency dict is given.</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">frequency</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">frequency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="mf">2.71828</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># Sort candidates alphabetically by total score</span>
    <span class="c1"># The harmonic mean will emphasize tf-idf score.</span>
    <span class="n">hmean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[(</span><span class="n">hmean</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span>

<span class="c1">#### COMMAND LINE ##################################################################################</span>
<span class="c1"># The commandline() function enables command line support for a Parser.</span>
<span class="c1"># The following code can be added to pattern.en, for example:</span>
<span class="c1">#</span>
<span class="c1"># from pattern.text import Parser, commandline</span>
<span class="c1"># parse = Parser(lexicon=LEXICON).parse</span>
<span class="c1"># if __name__ == &quot;main&quot;:</span>
<span class="c1">#     commandline(parse)</span>
<span class="c1">#</span>
<span class="c1"># The parser is then accessible from the command line:</span>
<span class="c1"># python -m pattern.en.parser xml -s &quot;Hello, my name is Dr. Sbaitso. Nice to meet you.&quot; -OTCLI</span>

<span class="k">def</span> <span class="nf">commandline</span><span class="p">(</span><span class="n">parse</span><span class="o">=</span><span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">optparse</span>
    <span class="kn">import</span> <span class="nn">codecs</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span>      <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">,</span>      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;text file to parse&quot;</span><span class="p">,</span>   <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--string&quot;</span><span class="p">,</span>    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;text string to parse&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;STRING&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-O&quot;</span><span class="p">,</span> <span class="s2">&quot;--tokenize&quot;</span><span class="p">,</span>  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span>  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;tokenize the input&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-T&quot;</span><span class="p">,</span> <span class="s2">&quot;--tags&quot;</span><span class="p">,</span>      <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span>      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;parse part-of-speech tags&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-C&quot;</span><span class="p">,</span> <span class="s2">&quot;--chunks&quot;</span><span class="p">,</span>    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;chunks&quot;</span><span class="p">,</span>    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;parse chunk tags&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-R&quot;</span><span class="p">,</span> <span class="s2">&quot;--relations&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;relations&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;find verb/predicate relations&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-L&quot;</span><span class="p">,</span> <span class="s2">&quot;--lemmata&quot;</span><span class="p">,</span>   <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;lemmata&quot;</span><span class="p">,</span>   <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;find word lemmata&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--encoding&quot;</span><span class="p">,</span>  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span>  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;character encoding&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span>   <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>   <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;version info&quot;</span><span class="p">)</span>
    <span class="n">o</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c1"># Version info.</span>
    <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">pattern</span> <span class="k">import</span> <span class="n">__version__</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">__version__</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Either a text file (-f) or a text string (-s) must be supplied.</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">file</span> <span class="ow">and</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="ow">or</span> <span class="n">o</span><span class="o">.</span><span class="n">string</span>
    <span class="c1"># The given text can be parsed in two modes:</span>
    <span class="c1"># - implicit: parse everything (tokenize, tag/chunk, find relations, lemmatize).</span>
    <span class="c1"># - explicit: define what to parse manually.</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">explicit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">tokenize</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">relations</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">lemmata</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">explicit</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">explicit</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">encoding</span> <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tokenize&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">tokenize</span>  <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">tags</span>      <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">chunks</span>    <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;relations&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">relations</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="s2">&quot;lemmata&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">lemmata</span>   <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">encoding</span> <span class="p">}</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">a</span><span class="p">)</span>
        <span class="c1"># The output can be either slash-formatted string or XML.</span>
        <span class="k">if</span> <span class="s2">&quot;xml&quot;</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">xml</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">encode_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="c1">#### VERBS #########################################################################################</span>

<span class="c1">#--- VERB TENSES -----------------------------------------------------------------------------------</span>
<span class="c1"># Conjugation is the inflection of verbs by tense, person, number, mood and aspect.</span>

<span class="c1"># VERB TENSE:</span>
<span class="n">INFINITIVE</span><span class="p">,</span> <span class="n">PRESENT</span><span class="p">,</span> <span class="n">PAST</span><span class="p">,</span> <span class="n">FUTURE</span> <span class="o">=</span> \
    <span class="n">INF</span><span class="p">,</span> <span class="n">PRES</span><span class="p">,</span> <span class="n">PST</span><span class="p">,</span> <span class="n">FUT</span> <span class="o">=</span> \
        <span class="s2">&quot;infinitive&quot;</span><span class="p">,</span> <span class="s2">&quot;present&quot;</span><span class="p">,</span> <span class="s2">&quot;past&quot;</span><span class="p">,</span> <span class="s2">&quot;future&quot;</span>

<span class="c1"># VERB PERSON:</span>
<span class="c1"># 1st person = I or we (plural).</span>
<span class="c1"># 2nd person = you.</span>
<span class="c1"># 3rd person = he, she, it or they (plural).</span>
<span class="n">FIRST</span><span class="p">,</span> <span class="n">SECOND</span><span class="p">,</span> <span class="n">THIRD</span> <span class="o">=</span> \
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>

<span class="c1"># VERB NUMBER:</span>
<span class="c1"># singular number = I, you, he, she, it.</span>
<span class="c1">#   plural number = we, you, they.</span>
<span class="n">SINGULAR</span><span class="p">,</span> <span class="n">PLURAL</span> <span class="o">=</span> \
    <span class="n">SG</span><span class="p">,</span> <span class="n">PL</span> <span class="o">=</span> \
        <span class="s2">&quot;singular&quot;</span><span class="p">,</span> <span class="s2">&quot;plural&quot;</span>

<span class="c1"># VERB MOOD:</span>
<span class="c1">#  indicative mood = a fact: &quot;the cat meowed&quot;.</span>
<span class="c1">#  imperative mood = a command: &quot;meow!&quot;.</span>
<span class="c1"># conditional mood = a hypothesis: &quot;a cat *will* meow *if* it is hungry&quot;.</span>
<span class="c1"># subjunctive mood = a wish, possibility or necessity: &quot;I *wish* the cat *would* stop meowing&quot;.</span>
<span class="n">INDICATIVE</span><span class="p">,</span> <span class="n">IMPERATIVE</span><span class="p">,</span> <span class="n">CONDITIONAL</span><span class="p">,</span> <span class="n">SUBJUNCTIVE</span> <span class="o">=</span> \
    <span class="n">IND</span><span class="p">,</span> <span class="n">IMP</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">SJV</span> <span class="o">=</span> \
        <span class="s2">&quot;indicative&quot;</span><span class="p">,</span> <span class="s2">&quot;imperative&quot;</span><span class="p">,</span> <span class="s2">&quot;conditional&quot;</span><span class="p">,</span> <span class="s2">&quot;subjunctive&quot;</span>

<span class="c1"># VERB ASPECT:</span>
<span class="c1"># imperfective aspect = a habitual or ongoing action: &quot;it was midnight; the cat meowed&quot;.</span>
<span class="c1">#   perfective aspect = a momentary or completed action: &quot;I flung my pillow at the cat&quot;.</span>
<span class="c1">#  progressive aspect = a incomplete action in progress: &quot;the cat was meowing&quot;.</span>
<span class="c1"># Note: the progressive aspect is a subtype of the imperfective aspect.</span>
<span class="n">IMPERFECTIVE</span><span class="p">,</span> <span class="n">PERFECTIVE</span><span class="p">,</span> <span class="n">PROGRESSIVE</span> <span class="o">=</span> \
    <span class="n">IPFV</span><span class="p">,</span> <span class="n">PFV</span><span class="p">,</span> <span class="n">PROG</span> <span class="o">=</span> \
        <span class="s2">&quot;imperfective&quot;</span><span class="p">,</span> <span class="s2">&quot;perfective&quot;</span><span class="p">,</span> <span class="s2">&quot;progressive&quot;</span>

<span class="c1"># Imperfect = past tense + imperfective aspect.</span>
<span class="c1"># Preterite = past tense + perfective aspect.</span>
<span class="n">IMPERFECT</span> <span class="o">=</span> <span class="s2">&quot;imperfect&quot;</span>
<span class="n">PRETERITE</span> <span class="o">=</span> <span class="s2">&quot;preterite&quot;</span>

<span class="c1"># Participle = present tense  + progressive aspect.</span>
<span class="n">PARTICIPLE</span><span class="p">,</span> <span class="n">GERUND</span> <span class="o">=</span> <span class="s2">&quot;participle&quot;</span><span class="p">,</span> <span class="s2">&quot;gerund&quot;</span>

<span class="c1"># Continuous aspect ≈ progressive aspect.</span>
<span class="n">CONTINUOUS</span> <span class="o">=</span> <span class="n">CONT</span> <span class="o">=</span> <span class="s2">&quot;continuous&quot;</span>

<span class="n">_</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># prettify the table =&gt;</span>

<span class="c1"># Unique index per tense (= tense + person + number + mood + aspect + negated? + aliases).</span>
<span class="c1"># The index is used to describe the format of the verb lexicon file.</span>
<span class="c1"># The aliases can be passed to Verbs.conjugate() and Tenses.__contains__().</span>
<span class="n">TENSES</span> <span class="o">=</span> <span class="p">{</span>
   <span class="kc">None</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>    <span class="n">_</span><span class="p">,</span>    <span class="n">_</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span>   <span class="p">,)),</span> <span class="c1">#       ENGLISH   SPANISH   GERMAN    DUTCH     FRENCH</span>
     <span class="mi">0</span> <span class="p">:</span> <span class="p">(</span> <span class="n">INF</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>    <span class="n">_</span><span class="p">,</span>    <span class="n">_</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;inf&quot;</span>  <span class="p">,)),</span> <span class="c1">#       to be     ser       sein      zijn      être</span>
     <span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sg&quot;</span>  <span class="p">,)),</span> <span class="c1">#     I am        soy       bin       ben       suis</span>
     <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg&quot;</span>  <span class="p">,)),</span> <span class="c1">#   you are       eres      bist      bent      es</span>
     <span class="mi">3</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg&quot;</span>  <span class="p">,)),</span> <span class="c1"># (s)he is        es        ist       is        est</span>
     <span class="mi">4</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl&quot;</span>  <span class="p">,)),</span> <span class="c1">#    we are       somos     sind      zijn      sommes</span>
     <span class="mi">5</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl&quot;</span>  <span class="p">,)),</span> <span class="c1">#   you are       sois      seid      zijn      êtes</span>
     <span class="mi">6</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl&quot;</span>  <span class="p">,)),</span> <span class="c1">#  they are       son       sind      zijn      sont</span>
     <span class="mi">7</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span> <span class="s2">&quot;pl&quot;</span>  <span class="p">,)),</span> <span class="c1">#       are</span>
     <span class="mi">8</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">PROG</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;part&quot;</span> <span class="p">,)),</span> <span class="c1">#       being     siendo              zijnd     étant</span>
     <span class="mi">9</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;1sg-&quot;</span> <span class="p">,)),</span> <span class="c1">#     I am not</span>
    <span class="mi">10</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;2sg-&quot;</span> <span class="p">,)),</span> <span class="c1">#   you aren&#39;t</span>
    <span class="mi">11</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;3sg-&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he isn&#39;t</span>
    <span class="mi">12</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;1pl-&quot;</span> <span class="p">,)),</span> <span class="c1">#    we aren&#39;t</span>
    <span class="mi">13</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;2pl-&quot;</span> <span class="p">,)),</span> <span class="c1">#   you aren&#39;t</span>
    <span class="mi">14</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;3pl-&quot;</span> <span class="p">,)),</span> <span class="c1">#  they aren&#39;t</span>
    <span class="mi">15</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span> <span class="s2">&quot;pl-&quot;</span> <span class="p">,)),</span> <span class="c1">#       aren&#39;t</span>
    <span class="mi">16</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span>   <span class="s2">&quot;-&quot;</span> <span class="p">,)),</span> <span class="c1">#       isn&#39;t</span>
    <span class="mi">17</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sgp&quot;</span> <span class="p">,)),</span> <span class="c1">#     I was       era       war       was       étais</span>
    <span class="mi">18</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sgp&quot;</span> <span class="p">,)),</span> <span class="c1">#   you were      eras      warst     was       étais</span>
    <span class="mi">19</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sgp&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he was       era       war       was       était</span>
    <span class="mi">20</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1ppl&quot;</span> <span class="p">,)),</span> <span class="c1">#    we were      éramos    waren     waren     étions</span>
    <span class="mi">21</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2ppl&quot;</span> <span class="p">,)),</span> <span class="c1">#   you were      erais     wart      waren     étiez</span>
    <span class="mi">22</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3ppl&quot;</span> <span class="p">,)),</span> <span class="c1">#  they were      eran      waren     waren     étaient</span>
    <span class="mi">23</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span> <span class="s2">&quot;ppl&quot;</span> <span class="p">,)),</span> <span class="c1">#       were</span>
    <span class="mi">24</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">PROG</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;ppart&quot;</span><span class="p">,)),</span> <span class="c1">#       been      sido      gewesen   geweest   été</span>
    <span class="mi">25</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>   <span class="s2">&quot;p&quot;</span> <span class="p">,)),</span> <span class="c1">#       was</span>
    <span class="mi">26</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;1sgp-&quot;</span><span class="p">,)),</span> <span class="c1">#     I wasn&#39;t</span>
    <span class="mi">27</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;2sgp-&quot;</span><span class="p">,)),</span> <span class="c1">#   you weren&#39;t</span>
    <span class="mi">28</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;3sgp-&quot;</span><span class="p">,)),</span> <span class="c1"># (s)he wasn&#39;t</span>
    <span class="mi">29</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;1ppl-&quot;</span><span class="p">,)),</span> <span class="c1">#    we weren&#39;t</span>
    <span class="mi">30</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;2ppl-&quot;</span><span class="p">,)),</span> <span class="c1">#   you weren&#39;t</span>
    <span class="mi">31</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;3ppl-&quot;</span><span class="p">,)),</span> <span class="c1">#  they weren&#39;t</span>
    <span class="mi">32</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span> <span class="s2">&quot;ppl-&quot;</span><span class="p">,)),</span> <span class="c1">#       weren&#39;t</span>
    <span class="mi">33</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>  <span class="n">_</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>  <span class="p">(</span> <span class="s2">&quot;p-&quot;</span>  <span class="p">,)),</span> <span class="c1">#       wasn&#39;t</span>
    <span class="mi">34</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sg+&quot;</span> <span class="p">,)),</span> <span class="c1">#     I           fui                           fus</span>
    <span class="mi">35</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg+&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           fuiste                        fus</span>
    <span class="mi">36</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg+&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he           fue                           fut</span>
    <span class="mi">37</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl+&quot;</span> <span class="p">,)),</span> <span class="c1">#    we           fuimos                        fûmes</span>
    <span class="mi">38</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl+&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           fuisteis                      fûtes</span>
    <span class="mi">39</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl+&quot;</span> <span class="p">,)),</span> <span class="c1">#  they           fueron                        furent</span>
    <span class="mi">40</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sgf&quot;</span> <span class="p">,)),</span> <span class="c1">#     I           seré                          serai</span>
    <span class="mi">41</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sgf&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           serás                         seras</span>
    <span class="mi">42</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sgf&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he           será                          sera</span>
    <span class="mi">43</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1plf&quot;</span> <span class="p">,)),</span> <span class="c1">#    we           seremos                       serons</span>
    <span class="mi">44</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2plf&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           seréis                        serez</span>
    <span class="mi">45</span> <span class="p">:</span> <span class="p">(</span> <span class="n">FUT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3plf&quot;</span> <span class="p">,)),</span> <span class="c1">#  they           serán                         seron</span>
    <span class="mi">46</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sg-&gt;&quot;</span><span class="p">,)),</span> <span class="c1">#     I           sería                         serais</span>
    <span class="mi">47</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg-&gt;&quot;</span><span class="p">,)),</span> <span class="c1">#   you           serías                        serais</span>
    <span class="mi">48</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg-&gt;&quot;</span><span class="p">,)),</span> <span class="c1"># (s)he           sería                         serait</span>
    <span class="mi">49</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl-&gt;&quot;</span><span class="p">,)),</span> <span class="c1">#    we           seríamos                      serions</span>
    <span class="mi">50</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl-&gt;&quot;</span><span class="p">,)),</span> <span class="c1">#   you           seríais                       seriez</span>
    <span class="mi">51</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span> <span class="n">COND</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl-&gt;&quot;</span><span class="p">,)),</span> <span class="c1">#  they           serían                        seraient</span>
    <span class="mi">52</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IMP</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg!&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           sé        sei                 sois</span>
    <span class="mi">521</span><span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">IMP</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg!&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he</span>
    <span class="mi">53</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IMP</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl!&quot;</span> <span class="p">,)),</span> <span class="c1">#    we                     seien               soyons</span>
    <span class="mi">54</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IMP</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl!&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           sed       seid                soyez</span>
    <span class="mi">541</span><span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">IMP</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl!&quot;</span> <span class="p">,)),</span> <span class="c1">#   you</span>
    <span class="mi">55</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sg?&quot;</span> <span class="p">,)),</span> <span class="c1">#     I           sea       sei                 sois</span>
    <span class="mi">56</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg?&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           seas      seist               sois</span>
    <span class="mi">57</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg?&quot;</span> <span class="p">,)),</span> <span class="c1"># (s)he           sea       sei                 soit</span>
    <span class="mi">58</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl?&quot;</span> <span class="p">,)),</span> <span class="c1">#    we           seamos    seien               soyons</span>
    <span class="mi">59</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl?&quot;</span> <span class="p">,)),</span> <span class="c1">#   you           seáis     seiet               soyez</span>
    <span class="mi">60</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl?&quot;</span> <span class="p">,)),</span> <span class="c1">#  they           sean      seien               soient</span>
    <span class="mi">61</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sg?+&quot;</span><span class="p">,)),</span> <span class="c1">#     I</span>
    <span class="mi">62</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sg?+&quot;</span><span class="p">,)),</span> <span class="c1">#   you</span>
    <span class="mi">63</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sg?+&quot;</span><span class="p">,)),</span> <span class="c1"># (s)he</span>
    <span class="mi">64</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1pl?+&quot;</span><span class="p">,)),</span> <span class="c1">#    we</span>
    <span class="mi">65</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2pl?+&quot;</span><span class="p">,)),</span> <span class="c1">#   you</span>
    <span class="mi">66</span> <span class="p">:</span> <span class="p">(</span><span class="n">PRES</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span>  <span class="n">PFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3pl?+&quot;</span><span class="p">,)),</span> <span class="c1">#  they</span>
    <span class="mi">67</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1sgp?&quot;</span><span class="p">,)),</span> <span class="c1">#     I           fuera     wäre                fusse</span>
    <span class="mi">68</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2sgp?&quot;</span><span class="p">,)),</span> <span class="c1">#   you           fueras    wärest              fusses</span>
    <span class="mi">69</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SG</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3sgp?&quot;</span><span class="p">,)),</span> <span class="c1"># (s)he           fuera     wäre                fût</span>
    <span class="mi">70</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;1ppl?&quot;</span><span class="p">,)),</span> <span class="c1">#    we           fuéramos  wären               fussions</span>
    <span class="mi">71</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;2ppl?&quot;</span><span class="p">,)),</span> <span class="c1">#   you           fuerais   wäret               fussiez</span>
    <span class="mi">72</span> <span class="p">:</span> <span class="p">(</span> <span class="n">PST</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span>  <span class="n">SJV</span><span class="p">,</span> <span class="n">IPFV</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;3ppl?&quot;</span><span class="p">,)),</span> <span class="c1">#  they           fueran    wären               fussent</span>
<span class="p">}</span>

<span class="c1"># Map tenses and aliases to unique index.</span>
<span class="c1"># Aliases include:</span>
<span class="c1"># - a short number: &quot;s&quot;, &quot;sg&quot;, &quot;singular&quot; =&gt; SINGULAR,</span>
<span class="c1"># - a short string: &quot;1sg&quot; =&gt; 1st person singular present,</span>
<span class="c1"># - a unique index:  1    =&gt; 1st person singular present,</span>
<span class="c1"># -  Penn treebank: &quot;VBP&quot; =&gt; 1st person singular present.</span>
<span class="n">TENSES_ID</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">TENSES_ID</span><span class="p">[</span><span class="n">INFINITIVE</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">tense</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">negated</span><span class="p">,</span> <span class="n">aliases</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TENSES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aliases</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="p">,):</span>
        <span class="n">TENSES_ID</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">TENSES_ID</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">TENSES_ID</span><span class="p">[(</span><span class="n">tense</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">negated</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="n">SG</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;sg&quot;</span><span class="p">,</span> <span class="s2">&quot;singular&quot;</span><span class="p">):</span>
            <span class="n">TENSES_ID</span><span class="p">[(</span><span class="n">tense</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">negated</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="n">PL</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;plural&quot;</span><span class="p">):</span>
            <span class="n">TENSES_ID</span><span class="p">[(</span><span class="n">tense</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">pl</span><span class="p">,</span> <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">negated</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>

<span class="c1"># Map Penn Treebank tags to unique index.</span>
<span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tense</span> <span class="ow">in</span> <span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;VB&quot;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">),</span>  <span class="c1"># infinitive</span>
  <span class="p">(</span><span class="s2">&quot;VBP&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">),</span>  <span class="c1"># present 1 singular</span>
  <span class="p">(</span><span class="s2">&quot;VBZ&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">),</span>  <span class="c1"># present 3 singular</span>
  <span class="p">(</span><span class="s2">&quot;VBG&quot;</span><span class="p">,</span> <span class="mi">8</span> <span class="p">),</span>  <span class="c1"># present participle</span>
  <span class="p">(</span><span class="s2">&quot;VBN&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>  <span class="c1"># past participle</span>
  <span class="p">(</span><span class="s2">&quot;VBD&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)):</span> <span class="c1"># past</span>
    <span class="n">TENSES_ID</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">tense</span>

<span class="c1"># tense(tense=INFINITIVE)</span>
<span class="c1"># tense(tense=(PRESENT, 3, SINGULAR))</span>
<span class="c1"># tense(tense=PRESENT, person=3, number=SINGULAR, mood=INDICATIVE, aspect=IMPERFECTIVE, negated=False)</span>
<span class="k">def</span> <span class="nf">tense_id</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the tense id for a given (tense, person, number, mood, aspect, negated).</span>
<span class="sd">        Aliases and compound forms (e.g., IMPERFECT) are disambiguated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Unpack tense given as a tuple, e.g., tense((PRESENT, 1, SG)):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">((</span><span class="n">PRESENT</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">),</span> <span class="p">(</span><span class="n">PAST</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">)):</span>
             <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># No parameters defaults to tense=INFINITIVE, tense=PRESENT otherwise.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">INFINITIVE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">PRESENT</span>
    <span class="c1"># Set default values.</span>
    <span class="n">tense</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tense&quot;</span>  <span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">person</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span> <span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
    <span class="n">number</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;number&quot;</span> <span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">SINGULAR</span><span class="p">)</span>
    <span class="n">mood</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mood&quot;</span>   <span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">INDICATIVE</span><span class="p">)</span>
    <span class="n">aspect</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aspect&quot;</span> <span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">IMPERFECTIVE</span><span class="p">)</span>
    <span class="n">negated</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negated&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Disambiguate wrong order of parameters.</span>
    <span class="k">if</span> <span class="n">mood</span> <span class="ow">in</span> <span class="p">(</span><span class="n">PERFECTIVE</span><span class="p">,</span> <span class="n">IMPERFECTIVE</span><span class="p">):</span>
        <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">INDICATIVE</span><span class="p">,</span> <span class="n">mood</span>
    <span class="c1"># Disambiguate INFINITIVE.</span>
    <span class="c1"># Disambiguate PARTICIPLE, IMPERFECT, PRETERITE.</span>
    <span class="c1"># These are often considered to be tenses but are in fact tense + aspect.</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="o">==</span> <span class="n">INFINITIVE</span><span class="p">:</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">number</span> <span class="o">=</span> <span class="n">mood</span> <span class="o">=</span> <span class="n">aspect</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">negated</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="ow">in</span> <span class="p">((</span><span class="n">PRESENT</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">),</span> <span class="n">PRESENT</span><span class="o">+</span><span class="n">PARTICIPLE</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">,</span> <span class="n">GERUND</span><span class="p">):</span>
        <span class="n">tense</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">PRESENT</span><span class="p">,</span> <span class="n">PROGRESSIVE</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="ow">in</span> <span class="p">((</span><span class="n">PAST</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">),</span> <span class="n">PAST</span><span class="o">+</span><span class="n">PARTICIPLE</span><span class="p">):</span>
        <span class="n">tense</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">PAST</span><span class="p">,</span> <span class="n">PROGRESSIVE</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="o">==</span> <span class="n">IMPERFECT</span><span class="p">:</span>
        <span class="n">tense</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">PAST</span><span class="p">,</span> <span class="n">IMPERFECTIVE</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="o">==</span> <span class="n">PRETERITE</span><span class="p">:</span>
        <span class="n">tense</span><span class="p">,</span> <span class="n">aspect</span> <span class="o">=</span> <span class="n">PAST</span><span class="p">,</span> <span class="n">PERFECTIVE</span>
    <span class="k">if</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONTINUOUS</span><span class="p">,</span> <span class="n">PARTICIPLE</span><span class="p">,</span> <span class="n">GERUND</span><span class="p">):</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="n">PROGRESSIVE</span>
    <span class="k">if</span> <span class="n">aspect</span> <span class="o">==</span> <span class="n">PROGRESSIVE</span><span class="p">:</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">number</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Disambiguate CONDITIONAL.</span>
    <span class="c1"># In Spanish, the conditional is regarded as an indicative tense.</span>
    <span class="k">if</span> <span class="n">tense</span> <span class="o">==</span> <span class="n">CONDITIONAL</span> <span class="ow">and</span> <span class="n">mood</span> <span class="o">==</span> <span class="n">INDICATIVE</span><span class="p">:</span>
        <span class="n">tense</span><span class="p">,</span> <span class="n">mood</span> <span class="o">=</span> <span class="n">PRESENT</span><span class="p">,</span> <span class="n">CONDITIONAL</span>
    <span class="c1"># Disambiguate aliases: &quot;pl&quot; =&gt;</span>
    <span class="c1"># (PRESENT, None, PLURAL, INDICATIVE, IMPERFECTIVE, False).</span>
    <span class="k">return</span> <span class="n">TENSES_ID</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tense</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
           <span class="n">TENSES_ID</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">tense</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mood</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">negated</span><span class="p">)))</span>

<span class="n">tense</span> <span class="o">=</span> <span class="n">tense_id</span>

<span class="c1">#--- VERB CONJUGATIONS -----------------------------------------------------------------------------</span>
<span class="c1"># Verb conjugations based on a table of known verbs and rules for unknown verbs.</span>
<span class="c1"># Verb conjugations are useful to find the verb infinitive in the parser&#39;s lemmatizer.</span>
<span class="c1"># For unknown verbs, Verbs.find_lemma() and Verbs.find_lexeme() are called.</span>
<span class="c1"># These must be implemented in a subclass with rules for unknown verbs.</span>

<span class="k">class</span> <span class="nc">Verbs</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="p">[],</span> <span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of verb infinitives, each linked to a list of conjugated forms.</span>
<span class="sd">            Each line in the file at the given path is one verb, with the tenses separated by a comma.</span>
<span class="sd">            The format defines the order of tenses (see TENSES).</span>
<span class="sd">            The default dictionary defines default tenses for omitted tenses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>     <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">TENSES_ID</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>  <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span>  <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># have,,,has,,having,,,,,had,had,haven&#39;t,,,hasn&#39;t,,,,,,,hadn&#39;t,hadn&#39;t</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">[</span><span class="n">TENSES_ID</span><span class="p">[</span><span class="n">INFINITIVE</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">if</span> <span class="n">x</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">infinitives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Yields a dictionary of (infinitive, [inflections])-items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inflections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Yields a dictionary of (inflected, infinitive)-items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">TENSES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Yields a list of tenses for this language, excluding negations.</span>
<span class="sd">            Each tense is a (tense, person, number, mood, aspect)-tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">TENSES</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">TENSES</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">TENSES</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Exclude negation.</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">lemma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the infinitive form of the given verb, or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verb</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span><span class="p">[</span><span class="n">verb</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse</span><span class="p">[</span><span class="n">verb</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">parse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># rule-based</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lemma</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lexeme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of all possible inflections of the given verb.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemma</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="n">parse</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">parse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># rule-based</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lexeme</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[];</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">u</span>

    <span class="k">def</span> <span class="nf">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Inflects the verb and returns the given tense (or None).</span>
<span class="sd">            For example: be</span>
<span class="sd">            - Verbs.conjugate(&quot;is&quot;, INFINITVE) =&gt; be</span>
<span class="sd">            - Verbs.conjugate(&quot;be&quot;, PRESENT, 1, SINGULAR) =&gt; I am</span>
<span class="sd">            - Verbs.conjugate(&quot;be&quot;, PRESENT, 1, PLURAL) =&gt; we are</span>
<span class="sd">            - Verbs.conjugate(&quot;be&quot;, PAST, 3, SINGULAR) =&gt; he was</span>
<span class="sd">            - Verbs.conjugate(&quot;be&quot;, PAST, aspect=PROGRESSIVE) =&gt; been</span>
<span class="sd">            - Verbs.conjugate(&quot;be&quot;, PAST, person=1, negated=True) =&gt; I wasn&#39;t</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">tense_id</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Get the tense index from the format description (or a default).</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="n">i3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemma</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Get the verb lexeme and return the requested index.</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># rule-based</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lexeme</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">tenses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of possible tenses for the given inflected verb.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verb</span> <span class="o">=</span> <span class="n">verb</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemma</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="n">parse</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">parse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># rule-based</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lexeme</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="c1"># For each tense in the verb lexeme that matches the given tense,</span>
        <span class="c1"># 1) retrieve the tense tuple,</span>
        <span class="c1"># 2) retrieve the tense tuples for which that tense is a default.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tense</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tense</span> <span class="o">==</span> <span class="n">verb</span><span class="p">:</span>
                <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">id2</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">id2</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">TENSES</span><span class="p">[</span><span class="nb">id</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Tenses</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">find_lemma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">):</span>
        <span class="c1"># Must be overridden in a subclass.</span>
        <span class="c1"># Must return the infinitive for the given conjugated (unknown) verb.</span>
        <span class="k">return</span> <span class="n">verb</span>

    <span class="k">def</span> <span class="nf">find_lexeme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">):</span>
        <span class="c1"># Must be overridden in a subclass.</span>
        <span class="c1"># Must return the list of conjugations for the given (unknown) verb.</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="k">class</span> <span class="nc">Tenses</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tense</span><span class="p">):</span>
        <span class="c1"># t in tenses(verb) also works when t is an alias (e.g. &quot;1sg&quot;).</span>
        <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TENSES</span><span class="p">[</span><span class="n">tense_id</span><span class="p">(</span><span class="n">tense</span><span class="p">)][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

<span class="c1">### SENTIMENT POLARITY LEXICON #####################################################################</span>
<span class="c1"># A sentiment lexicon can be used to discern objective facts from subjective opinions in text.</span>
<span class="c1"># Each word in the lexicon has scores for:</span>
<span class="c1"># 1)     polarity: negative vs. positive    (-1.0 =&gt; +1.0)</span>
<span class="c1"># 2) subjectivity: objective vs. subjective (+0.0 =&gt; +1.0)</span>
<span class="c1"># 3)    intensity: modifies next word?      (x0.5 =&gt; x2.0)</span>

<span class="c1"># For English, adverbs are used as modifiers (e.g., &quot;very good&quot;).</span>
<span class="c1"># For Dutch, adverbial adjectives are used as modifiers</span>
<span class="c1"># (&quot;hopeloos voorspelbaar&quot;, &quot;ontzettend spannend&quot;, &quot;verschrikkelijk goed&quot;).</span>
<span class="c1"># Negation words (e.g., &quot;not&quot;) reverse the polarity of the following word.</span>

<span class="c1"># Sentiment()(txt) returns an averaged (polarity, subjectivity)-tuple.</span>
<span class="c1"># Sentiment().assessments(txt) returns a list of (chunk, polarity, subjectivity, label)-tuples.</span>

<span class="c1"># Semantic labels are useful for fine-grained analysis, e.g.,</span>
<span class="c1"># negative words + positive emoticons could indicate cynicism.</span>

<span class="c1"># Semantic labels:</span>
<span class="n">MOOD</span>  <span class="o">=</span> <span class="s2">&quot;mood&quot;</span>  <span class="c1"># emoticons, emojis</span>
<span class="n">IRONY</span> <span class="o">=</span> <span class="s2">&quot;irony&quot;</span> <span class="c1"># sarcasm mark (!)</span>

<span class="n">NOUN</span><span class="p">,</span> <span class="n">VERB</span><span class="p">,</span> <span class="n">ADJECTIVE</span><span class="p">,</span> <span class="n">ADVERB</span> <span class="o">=</span> \
    <span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;VB&quot;</span><span class="p">,</span> <span class="s2">&quot;JJ&quot;</span><span class="p">,</span> <span class="s2">&quot;RB&quot;</span>

<span class="n">RE_SYNSET</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[acdnrv][-_][0-9]+$&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Score</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="n">subjectivity</span><span class="p">,</span> <span class="n">assessments</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; A (polarity, subjectivity)-tuple with an assessments property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">polarity</span><span class="p">,</span> <span class="n">subjectivity</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="n">subjectivity</span><span class="p">,</span> <span class="n">assessments</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span> <span class="o">=</span> <span class="n">assessments</span>

<span class="k">class</span> <span class="nc">Sentiment</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">synset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of words (adjectives) and polarity scores (positive/negative).</span>
<span class="sd">            The value for each word is a dictionary of part-of-speech tags.</span>
<span class="sd">            The value for each word POS-tag is a tuple with values for</span>
<span class="sd">            polarity (-1.0-1.0), subjectivity (0.0-1.0) and intensity (0.5-2.0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>       <span class="o">=</span> <span class="n">path</span>   <span class="c1"># XML file path.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_language</span>   <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># XML language attribute (&quot;en&quot;, &quot;fr&quot;, ...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confidence</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># XML confidence attribute threshold (&gt;=).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synset</span>     <span class="o">=</span> <span class="n">synset</span> <span class="c1"># XML synset attribute (&quot;wordnet_id&quot;, &quot;cornetto_id&quot;, ...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synsets</span>    <span class="o">=</span> <span class="p">{}</span>     <span class="c1"># {&quot;a-01123879&quot;: (1.0, 1.0, 1.0)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span>     <span class="o">=</span> <span class="p">{}</span>     <span class="c1"># {&quot;dammit&quot;: &quot;profanity&quot;}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokenizer&quot;</span><span class="p">,</span> <span class="n">find_tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negations</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negations&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;not&quot;</span><span class="p">,</span> <span class="s2">&quot;n&#39;t&quot;</span><span class="p">,</span> <span class="s2">&quot;never&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;RB&quot;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modifier&quot;</span> <span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ly&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">confidence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads the XML-file (with sentiment annotations) from the given path.</span>
<span class="sd">            By default, Sentiment.path is lazily loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># &lt;word form=&quot;great&quot; wordnet_id=&quot;a-01123879&quot; pos=&quot;JJ&quot; polarity=&quot;1.0&quot; subjectivity=&quot;1.0&quot; intensity=&quot;1.0&quot; /&gt;</span>
        <span class="c1"># &lt;word form=&quot;damnmit&quot; polarity=&quot;-0.75&quot; subjectivity=&quot;1.0&quot; label=&quot;profanity&quot; /&gt;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">words</span><span class="p">,</span> <span class="n">synsets</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">cElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">xml</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;word&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence</span> <span class="ow">is</span> <span class="kc">None</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confidence</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)):</span>
                <span class="n">w</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">synset</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;polarity&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subjectivity&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synset</span><span class="p">)</span> <span class="c1"># wordnet_id, cornetto_id, ...</span>
                <span class="p">)</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                    <span class="n">words</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">w</span> <span class="ow">and</span> <span class="n">label</span><span class="p">:</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
                <span class="k">if</span> <span class="n">synset</span><span class="p">:</span>
                    <span class="n">synsets</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">synset</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_language</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language</span><span class="p">)</span>
        <span class="c1"># Average scores of all word senses per part-of-speech tag.</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="n">words</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span> <span class="p">[</span><span class="n">avg</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">psi</span><span class="p">)])</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">psi</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="c1"># Average scores of all part-of-speech tags.</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">words</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">avg</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
        <span class="c1"># Average scores of all synonyms per synset.</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">psi</span> <span class="ow">in</span> <span class="n">synsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">synsets</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">avg</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">psi</span><span class="p">)]</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synsets</span><span class="p">,</span> <span class="n">synsets</span><span class="p">)</span>

<div class="viewcode-block" id="Sentiment.synset"><a class="viewcode-back" href="../../api_reference.html#textblob_de.sentiments.Sentiment.synset">[docs]</a>    <span class="k">def</span> <span class="nf">synset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">ADJECTIVE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a (polarity, subjectivity)-tuple for the given synset id.</span>
<span class="sd">            For example, the adjective &quot;horrible&quot; has id 193480 in WordNet:</span>
<span class="sd">            Sentiment.synset(193480, pos=&quot;JJ&quot;) =&gt; (-0.6, 1.0, 1.0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;n-&quot;</span><span class="p">,</span> <span class="s2">&quot;v-&quot;</span><span class="p">,</span> <span class="s2">&quot;a-&quot;</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">NOUN</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;n-&quot;</span> <span class="o">+</span> <span class="nb">id</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">VERB</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;v-&quot;</span> <span class="o">+</span> <span class="nb">id</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">ADJECTIVE</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;a-&quot;</span> <span class="o">+</span> <span class="nb">id</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">ADVERB</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;r-&quot;</span> <span class="o">+</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synsets</span><span class="p">[</span><span class="nb">id</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># Some WordNet id&#39;s are not zero padded.</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;-0+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))[:</span><span class="mi">2</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">negation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a (polarity, subjectivity)-tuple for the given sentence,</span>
<span class="sd">            with polarity between -1.0 and 1.0 and subjectivity between 0.0 and 1.0.</span>
<span class="sd">            The sentence can be a string, Synset, Text, Sentence, Chunk, Word, Document, Vector.</span>
<span class="sd">            An optional weight parameter can be given,</span>
<span class="sd">            as a function that takes a list of words and returns a weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="n">assessments</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">words</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">assessments</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">weighted</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">score</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="n">w</span>
            <span class="k">return</span> <span class="n">s</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># A pattern.en.wordnet.Synset.</span>
        <span class="c1"># Sentiment(synsets(&quot;horrible&quot;, &quot;JJ&quot;)[0]) =&gt; (-0.6, 1.0)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;gloss&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="o">.</span><span class="n">synonyms</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">synset</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)]</span>
        <span class="c1"># A synset id.</span>
        <span class="c1"># Sentiment(&quot;a-00193480&quot;) =&gt; horrible =&gt; (-0.6, 1.0)   (English WordNet)</span>
        <span class="c1"># Sentiment(&quot;c_267&quot;) =&gt; verschrikkelijk =&gt; (-0.9, 1.0) (Dutch Cornetto)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RE_SYNSET</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="o">.</span><span class="n">synonyms</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">synset</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)]</span>
        <span class="c1"># A string of words.</span>
        <span class="c1"># Sentiment(&quot;a horrible movie&quot;) =&gt; (-0.6, 1.0)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(((</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span> <span class="n">negation</span><span class="p">)</span>
        <span class="c1"># A pattern.en.Text.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;sentences&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(((</span><span class="n">w</span><span class="o">.</span><span class="n">lemma</span> <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)),</span> <span class="n">negation</span><span class="p">)</span>
        <span class="c1"># A pattern.en.Sentence or pattern.en.Chunk.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;lemmata&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(((</span><span class="n">w</span><span class="o">.</span><span class="n">lemma</span> <span class="ow">or</span> <span class="n">w</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">words</span><span class="p">),</span> <span class="n">negation</span><span class="p">)</span>
        <span class="c1"># A pattern.en.Word.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;lemma&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(((</span><span class="n">s</span><span class="o">.</span><span class="n">lemma</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),),</span> <span class="n">negation</span><span class="p">)</span>
        <span class="c1"># A pattern.vector.Document.</span>
        <span class="c1"># Average score = weighted average using feature weights.</span>
        <span class="c1"># Bag-of words is unordered: inject None between each two words</span>
        <span class="c1"># to stop assessments() from scanning for preceding negation &amp; modifiers.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(((</span><span class="n">w</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)),</span> <span class="n">negation</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">terms</span><span class="p">[</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c1"># A dict of (word, weight)-items.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(((</span><span class="n">w</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)),</span> <span class="n">negation</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c1"># A list of words.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessments</span><span class="p">(((</span><span class="n">w</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="p">),</span> <span class="n">negation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Each &quot;w&quot; in &quot;a&quot; is a (words, polarity, subjectivity, label)-tuple.</span>
        <span class="k">return</span> <span class="n">Score</span><span class="p">(</span><span class="n">polarity</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">a</span><span class="p">),</span> <span class="n">weight</span><span class="p">),</span>
                 <span class="n">subjectivity</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">a</span><span class="p">),</span> <span class="n">weight</span><span class="p">),</span>
                  <span class="n">assessments</span> <span class="o">=</span> <span class="n">a</span><span class="p">)</span>

<div class="viewcode-block" id="Sentiment.assessments"><a class="viewcode-back" href="../../api_reference.html#textblob_de.sentiments.Sentiment.assessments">[docs]</a>    <span class="k">def</span> <span class="nf">assessments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[],</span> <span class="n">negation</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of (chunk, polarity, subjectivity, label)-tuples for the given list of words:</span>
<span class="sd">            where chunk is a list of successive words: a known word optionally</span>
<span class="sd">            preceded by a modifier (&quot;very good&quot;) or a negation (&quot;not good&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Preceding modifier (i.e., adverb or adjective).</span>
        <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Preceding negation (e.g., &quot;not beautiful&quot;).</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="c1"># Only assess known words, preferably by part-of-speech tag.</span>
            <span class="c1"># Including unknown words (polarity 0.0 and subjectivity 0.0) lowers the average.</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
                <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span>
                <span class="c1"># Known word not preceded by a modifier (&quot;good&quot;).</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
                <span class="c1"># Known word preceded by a modifier (&quot;really good&quot;).</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">],</span> <span class="o">+</span><span class="mf">1.0</span><span class="p">))</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">],</span> <span class="o">+</span><span class="mf">1.0</span><span class="p">))</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="c1"># Known word preceded by a negation (&quot;not really good&quot;).</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;i&quot;</span><span class="p">]</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="c1"># Known word may be a negation.</span>
                <span class="c1"># Known word may be modifying the next word (i.e., it is a known adverb).</span>
                <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="ow">and</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">negation</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negations</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">w</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unknown word may be a negation (&quot;not good&quot;).</span>
                <span class="k">if</span> <span class="n">negation</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negations</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">w</span>
                <span class="c1"># Unknown word. Retain negation across small words (&quot;not a good&quot;).</span>
                <span class="k">elif</span> <span class="n">n</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Unknown word may be a negation preceded by a modifier (&quot;really not good&quot;).</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Unknown word. Retain modifier across small words (&quot;really is a good&quot;).</span>
                <span class="k">elif</span> <span class="n">m</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Exclamation marks boost previous word.</span>
                <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s2">&quot;!&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">)</span>
                    <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span> <span class="o">+</span><span class="mf">1.0</span><span class="p">))</span>
                <span class="c1"># Exclamation marks in parentheses indicate sarcasm.</span>
                <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s2">&quot;(!)&quot;</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">IRONY</span><span class="p">))</span>
                <span class="c1"># EMOTICONS: {(&quot;grin&quot;, +1.0): set((&quot;:-D&quot;, &quot;:D&quot;))}</span>
                <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PUNCTUATION</span><span class="p">:</span> <span class="c1"># speedup</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">EMOTICONS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">e</span><span class="p">):</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">MOOD</span><span class="p">))</span>
                            <span class="k">break</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;n&quot;</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="c1"># &quot;not good&quot; = slightly bad, &quot;not bad&quot; = slightly good.</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="Sentiment.annotate"><a class="viewcode-back" href="../../api_reference.html#textblob_de.sentiments.Sentiment.annotate">[docs]</a>    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">polarity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">subjectivity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Annotates the given word with polarity, subjectivity and intensity scores,</span>
<span class="sd">            and optionally a semantic label (e.g., MOOD for emoticons, IRONY for &quot;(!)&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">w</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">polarity</span><span class="p">,</span> <span class="n">subjectivity</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labeler</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span></div>

<span class="c1">#### SPELLING CORRECTION ###########################################################################</span>
<span class="c1"># Based on: Peter Norvig, &quot;How to Write a Spelling Corrector&quot;, http://norvig.com/spell-correct.html</span>

<span class="k">class</span> <span class="nc">Spelling</span><span class="p">(</span><span class="n">lazydict</span><span class="p">):</span>

    <span class="n">ALPHA</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;spelling.txt&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Counts the words in the given string and saves the probabilities at the given path.</span>
<span class="sd">            This can be used to generate a new model for the Spelling() constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;[a-z]+&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="n">model</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">model</span> <span class="ow">and</span> <span class="n">model</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_edit1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a set of words with edit distance 1 from the given word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Of all spelling errors, 80% is covered by edit distance 1.</span>
        <span class="c1"># Edit distance 1 = one character deleted, swapped, replaced or inserted.</span>
        <span class="n">split</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">delete</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">insert</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">split</span> <span class="k">if</span> <span class="n">b</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">split</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">split</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Spelling</span><span class="o">.</span><span class="n">ALPHA</span> <span class="k">if</span> <span class="n">b</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">split</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Spelling</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">delete</span> <span class="o">+</span> <span class="n">transpose</span> <span class="o">+</span> <span class="n">replace</span> <span class="o">+</span> <span class="n">insert</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_edit2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a set of words with edit distance 2 from the given word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Of all spelling errors, 99% is covered by edit distance 2.</span>
        <span class="c1"># Only keep candidates that are actually known words (20% speedup).</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">e2</span> <span class="k">for</span> <span class="n">e1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edit1</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">e2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edit1</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="k">if</span> <span class="n">e2</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_known</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Returns the given list of words filtered by known words.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of (word, confidence) spelling corrections for the given word,</span>
<span class="sd">            based on the probability of known words with edit distance 1-2 from the given word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">w</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="c1"># I</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">PUNCTUATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">w</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="c1"># .?!</span>
        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">w</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="c1"># 1.5</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_known</span><span class="p">([</span><span class="n">w</span><span class="p">])</span> \
                  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_known</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edit1</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> \
                  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_known</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edit2</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> \
                  <span class="ow">or</span> <span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(((</span><span class="n">p</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w</span><span class="o">.</span><span class="n">istitle</span><span class="p">()</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="ow">or</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">]</span> <span class="c1"># case-sensitive</span>
        <span class="k">return</span> <span class="n">candidates</span>

<span class="c1">#### MULTILINGUAL ##################################################################################</span>
<span class="c1"># The default functions in each language submodule, with an optional language parameter:</span>
<span class="c1"># from pattern.text import parse</span>
<span class="c1"># print(parse(&quot;The cat sat on the mat.&quot;, language=&quot;en&quot;))</span>
<span class="c1"># print(parse(&quot;De kat zat op de mat.&quot;, language=&quot;nl&quot;))</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="s2">&quot;fr&quot;</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;nl&quot;</span><span class="p">]</span>

<span class="n">_modules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">def</span> <span class="nf">_module</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the given language module (e.g., &quot;en&quot; =&gt; pattern.en).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="p">{},</span> <span class="p">[],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_multilingual</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the value from the function with the given name in the given language module.</span>
<span class="sd">        By default, language=&quot;en&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_module</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">)),</span> <span class="n">function</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a (language, confidence)-tuple for the given string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">decode_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">PUNCTUATION</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">:</span>
        <span class="n">lexicon</span> <span class="o">=</span> <span class="n">_module</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;lexicon&quot;</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">lexicon</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">)))</span>
    
<span class="n">lang</span> <span class="o">=</span> <span class="n">language</span>

<span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;tokenize&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parsetree</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;parsetree&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;suggest&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sentiment</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;sentiment&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">singularize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;singularize&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pluralize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;pluralize&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">conjugate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;conjugate&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">predicative</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;predicative&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_multilingual</span><span class="p">(</span><span class="s2">&quot;suggest&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2019, Markus Killer (http://langui.ch)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>